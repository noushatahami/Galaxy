<!DOCTYPE html>
<html lang="en">
<head>
  <base href="../../" />
  <title>Masterly Galaxy | Galaxy Dashboard</title>

  <meta charset="utf-8" />
  <meta name="description" content="Masterly Galaxy" />
  <meta name="keywords" content="masterly galaxy" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="shortcut icon" href="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-fav.png" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
  <link href="/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
  <link href="/assets/css/style.masterly.css" rel="stylesheet" type="text/css" />
  <link href="/assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />

  <style>
    /* Enhanced card styling - monochrome, no 3D lift */
    .card-3d{
      border:1px solid rgba(255,255,255,.12);
      background:linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.03) 100%);
      box-shadow:
        0 8px 32px rgba(0,0,0,.18),
        0 2px 8px rgba(0,0,0,.12),
        inset 0 1px 0 rgba(255,255,255,.1),
        inset 0 -1px 0 rgba(0,0,0,.1);
      border-radius:20px;
      transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      min-width:0;
    }
    
    .card-3d:hover{ 
      box-shadow:
        0 12px 40px rgba(0,0,0,.22),
        0 4px 12px rgba(0,0,0,.15),
        inset 0 1px 0 rgba(255,255,255,.15);
      border-color: rgba(255,255,255,.18);
    }
    
    .card-3d .card-header{ 
      border-bottom:1px solid rgba(255,255,255,.1); 
      background: rgba(255,255,255,.03);
      padding: 1.5rem 1.75rem;
    }
    
    .card-3d .card-header h3 {
      font-size: 1.1rem;
      letter-spacing: 0.02em;
    }
    
    .card-3d .card-header .card-title::before {
      content: '';
      display: inline-block;
      width: 4px;
      height: 20px;
      background: rgba(255,255,255,.3);
      margin-right: 12px;
      border-radius: 2px;
      vertical-align: middle;
    }
    
    .card-3d .card-body {
      padding: 1.75rem;
    }

    /* Subtle glow on hover */
    .card-3d::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(255,255,255,.05) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      opacity: 0;
      transition: opacity .3s ease;
      pointer-events: none;
    }
    
    .card-3d:hover::after {
      opacity: 1;
    }

    /* List styling */
    .card-3d ul li {
      padding: 0.5rem 0;
      border-bottom: 1px dashed rgba(255,255,255,.05);
      transition: all .2s ease;
    }
    
    .card-3d ul li:last-child {
      border-bottom: none;
    }
    
    .card-3d ul li:hover {
      padding-left: 8px;
      opacity: 0.8;
    }

    /* Harden the grid */
    .row { max-width:100%; overflow-x:hidden; }
    .col-xl-8, .col-xl-4 { min-width:0; }
    .col-xl-8 > *, .col-xl-4 > * { min-width:0; }
    .app-container, #kt_app_content_container { overflow-x:hidden; }

    /* Research Topics word cloud */
    #research_topics_card .card-body{
      height: 360px;
      padding: 1rem;
    }
    #rt_cloud_container{
      width: 100%;
      height: 100%;
      border: 1px dashed rgba(255,255,255,.15);
      border-radius: 12px;
      background: rgba(0,0,0,.12);
      overflow: hidden;
      box-sizing: border-box;
      cursor: pointer;
      transition: all .2s ease;
    }
    #rt_cloud_container:hover {
      border-color: rgba(255,255,255,.25);
      background: rgba(0,0,0,.15);
      transform: scale(1.02);
    }
    #rt_wordcloud{
      display: block;
      width: 100%;
      height: 100%;
      max-width: 100%;
      max-height: 100%;
    }
    @media (max-width: 1200px){ #research_topics_card .card-body { height: 320px; } }
    @media (max-width: 992px){  #research_topics_card .card-body { height: 280px; } }
    @media (max-width: 576px){  #research_topics_card .card-body { height: 240px; } }

    /* hide the lists so only the cloud shows */
    #research_topics_tags,
    #rt_wordcloud_legend { display: none !important; }

    /* Modal styling */
    .rt-modal{
      position:fixed; inset:0; z-index: 1100; display:none;
      align-items:center; justify-content:center;
    }
    .rt-modal.is-open{ display:flex; }
    .rt-modal__backdrop{
      position:absolute; inset:0; background:rgba(0,0,0,.7); backdrop-filter: blur(4px);
    }
    .rt-modal__dialog{
      position:relative; z-index:1;
      width:min(1100px, calc(100vw - 32px));
      height:min(800px, calc(100vh - 32px));
      border-radius:20px; overflow:hidden;
      background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.15);
      box-shadow:0 20px 60px rgba(0,0,0,.5);
      display:flex; flex-direction:column;
    }
    .rt-modal__header{
      display:flex; align-items:center; justify-content:space-between;
      padding:1rem 1.5rem;
      border-bottom:1px solid rgba(255,255,255,.1);
      background: rgba(255,255,255,.03);
    }
    .rt-modal__body{
      flex:1; padding:8px;
      background:rgba(0,0,0,.10);
      border-top:1px dashed rgba(255,255,255,.08);
    }
    #rt_modal_container{ width:100%; height:100%; }
    #rt_modal_canvas{ width:100%; height:100%; display:block; }
    body.rt-modal-open{ overflow:hidden; }

    /* Publication items styling */
    .publication-item {
      padding: 1.5rem;
      border-radius: 12px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
      transition: all .2s ease;
    }
    .publication-item:hover {
      background: rgba(255,255,255,.05);
      border-color: rgba(255,255,255,.12);
      transform: translateX(4px);
    }

    /* Badge styling */
    .badge {
      padding: .4rem .75rem;
      border-radius: 999px;
      background: rgba(255,255,255,.1);
      border: 1px solid rgba(255,255,255,.15);
      font-size: .875rem;
      font-weight: 500;
      transition: all .2s ease;
    }
    .badge:hover {
      background: rgba(255,255,255,.15);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }
  </style>
</head>
<body id="kt_app_body" data-kt-app-header-fixed="true" data-kt-app-header-fixed-mobile="true" data-kt-app-sidebar-enabled="true" data-kt-app-sidebar-fixed="true" data-kt-app-sidebar-hoverable="true" data-kt-app-sidebar-push-toolbar="true" data-kt-app-sidebar-push-footer="true" data-kt-app-toolbar-enabled="true" data-kt-app-aside-enabled="true" data-kt-app-aside-fixed="true" data-kt-app-aside-push-toolbar="true" data-kt-app-aside-push-footer="true" class="app-default">

<!-- Word Cloud Modal -->
<div id="rt_modal" class="rt-modal" aria-hidden="true">
  <div class="rt-modal__backdrop"></div>

  <div class="rt-modal__dialog" role="dialog" aria-modal="true" aria-label="Research Topics">
    <div class="rt-modal__header">
      <h3 class="m-0 fw-bold">Research Topics</h3>
      <button id="rt_modal_close" class="btn btn-sm btn-light">
        <i class="ki-duotone ki-cross fs-3">
          <span class="path1"></span>
          <span class="path2"></span>
        </i>
        Close
      </button>
    </div>

    <div id="rt_modal_container" class="rt-modal__body">
      <canvas id="rt_modal_canvas" aria-label="Expanded research topics word cloud"></canvas>
    </div>
  </div>
</div>

<script>
  var defaultThemeMode="light";var themeMode;
  if(document.documentElement){
    if(document.documentElement.hasAttribute("data-bs-theme-mode")){
      themeMode=document.documentElement.getAttribute("data-bs-theme-mode");
    }else{
      themeMode=localStorage.getItem("data-bs-theme")??defaultThemeMode;
    }
    if(themeMode==="system"){ themeMode=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"; }
    document.documentElement.setAttribute("data-bs-theme", themeMode);
  }
</script>

<div class="d-flex flex-column flex-root app-root" id="kt_app_root">
  <div class="app-page flex-column flex-column-fluid" id="kt_app_page">
    <!--begin::Header-->
    <div id="kt_app_header" class="app-header d-flex flex-column flex-stack">
      <div class="d-flex align-items-center flex-stack flex-grow-1">
        <div class="app-header-logo d-flex align-items-center flex-stack px-lg-11 mb-2" id="kt_app_header_logo">
          <div class="btn btn-icon btn-active-color-primary w-35px h-35px ms-3 me-5 d-flex d-lg-none" id="kt_app_sidebar_mobile_toggle">
            <i class="ki-solid ki-abstract-14 fs-2tx"></i>
          </div>
          <a href="https://core.masterly.ca/" class="app-sidebar-logo">
            <img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-light-show d-lg-none" style="width:70%" />
            <img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-light-show d-lg-block d-none" style="width:95%" />
            <img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-dark-show" style="width:100%" />
          </a>
          <div id="kt_app_sidebar_toggle" class="app-sidebar-toggle btn btn-sm btn-icon btn-color-gray-600 btn-active-color-dark me-n2 d-none d-lg-flex" data-kt-toggle="true" data-kt-toggle-state="active" data-kt-toggle-target="body" data-kt-toggle-name="app-sidebar-minimize" onclick="toggleSidebarIcon(this)" title="Click to toggle the sidebar">
            <i class="ki-duotone ki-element-7 fs-2x">
								<span class="path1"></span>
								<span class="path2"></span>
							</i>
          </div>
        </div>

        <div class="app-navbar flex-grow-1 justify-content-end" id="kt_app_header_navbar">
          <div class="app-navbar-item d-flex align-items-stretch flex-lg-grow-1 me-2 me-lg-0">
            <div class="header-search d-flex align-items-center w-lg-350px" data-kt-search-keypress="true" data-kt-search-min-length="2" data-kt-search-enter="enter" data-kt-search-layout="menu" data-kt-search-responsive="true" data-kt-menu-trigger="auto" data-kt-menu-permanent="true" data-kt-menu-placement="bottom-start">
              <div class="d-none d-lg-block w-100 position-relative mb-5 mb-lg-0" autocomplete="off">
                <select data-control="select2" data-placeholder="Select a Masterly Service" class="form-select form-select-lg fw-semibold border-0 h-lg-40px" id="js-masterly-product-select">
                  <option></option>
                  <option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/findware.svg" value="1">FindWare</option>
                  <option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/sos.svg" value="2">SOS</option>
                  <option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/forms.svg" value="3">Forms</option>
                  <option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/orbit.svg" value="4">Orbit</option>
                </select>
              </div>
              <span class="badge badge-danger ms-5" id="js-product-free-trial-badge" style="display:none">free trial</span>
            </div>
          </div>

          <div class="app-navbar-item ms-3 ms-lg-4 ms-n2 me-3 d-flex d-lg-none">
            <div class="btn btn-icon btn-active-color-dark w-35px h-35px ms-3 me-2 d-flex d-lg-none" id="kt_app_aside_mobile_toggle">
              <i class="ki-solid ki-dots-vertical" style="font-size:30px; font-weight:bold"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="app-header-separator"></div>
    </div>
    <!--end::Header-->
    <div class="app-wrapper flex-column flex-row-fluid" id="kt_app_wrapper">
      <!--begin::Sidebar-->
          <div id="kt_app_sidebar" class="app-sidebar flex-column" data-kt-drawer="true" data-kt-drawer-name="app-sidebar" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="250px" data-kt-drawer-direction="start" data-kt-drawer-toggle="#kt_app_sidebar_mobile_toggle">
            <!--begin::Main-->
            <div class="d-flex flex-column justify-content-between h-100 hover-scroll-overlay-y my-2 d-flex flex-column" id="kt_app_sidebar_main" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_header" data-kt-scroll-wrappers="#kt_app_main" data-kt-scroll-offset="5px">
              <!--begin::Sidebar menu-->
              <div id="#kt_app_sidebar_menu" data-kt-menu="true" data-kt-menu-expand="false" class="flex-column-fluid menu menu-sub-indention menu-column menu-rounded menu-active-bg mb-7">
                <!--begin:Menu item-->
                <div class="menu-item">
                <!--begin:Menu link-->
                <a class="menu-link" href="https://core.masterly.ca/dashboard" target="_blank">
                  <span class="menu-icon">
                  <i class="ki-duotone ki-home fs-1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                    <span class="path4"></span>
                  </i>
                  </span>
                  <span class="menu-title">Masterly Home</span>
                </a>
                <!--end:Menu link-->
                </div>
                <!--end:Menu item-->
                <!--begin:Menu item-->
                <div class="menu-item">
                <!--begin:Menu link-->
                <a class="menu-link" href="index.html" target="_blank">
                  <span class="menu-icon">
                  <i class="ki-duotone ki-element-11 fs-1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                    <span class="path4"></span>
                  </i>
                  </span>
                  <span class="menu-title">Dashboard</span>
                </a>
                <!--end:Menu link-->
                </div>
                <!--end:Menu item-->
                <!--begin:Menu item-->
                <div class="menu-item">
                <!--begin:Menu link-->
                <a class="menu-link" href="https://core.masterly.ca/settings/profile" target="_blank">
                  <span class="menu-icon">
                  <i class="ki-duotone ki-user fs-1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                    <span class="path4"></span>
                  </i>
                  </span>
                  <span class="menu-title">My profile</span>
                </a>
                <!--end:Menu link-->
                </div>
                <!--end:Menu item-->
                <!--begin:Menu item-->
                <div class="menu-item">
                <!--begin:Menu link-->
                <a class="menu-link" href="https://core.masterly.ca/get-started" target="_blank">
                  <span class="menu-icon">
                  <i class="ki-duotone ki-information-4 fs-1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                    <span class="path3"></span>
                    <span class="path4"></span>
                  </i>
                  </span>
                  <span class="menu-title">Tutorials</span>
                </a>
                <!--end:Menu link-->
                </div>
                <!--end:Menu item-->
                <!--begin:Menu item-->
                <div data-kt-menu-trigger="click" class="menu-item here show menu-accordion">
                  <!--begin:Menu link-->
                  <span class="menu-link">
                    <span class="menu-icon">
                      <i class="ki-duotone ki-note-2 fs-1">
                        <span class="path1"></span>
                        <span class="path2"></span>
                        <span class="path3"></span>
                        <span class="path4"></span>
                      </i>
                    </span>
                    <span class="menu-title">Galaxy</span>
                    <span class="menu-arrow"></span>
                  </span>
                  <!--end:Menu link-->
                  <!--begin:Menu sub-->
                  <div class="menu-sub menu-sub-accordion">
                    <!--begin:Menu item-->
                    <div class="menu-item">
                      <!--begin:Menu link-->
                      <a class="menu-link" href="galaxy/profile.html">
                        <span class="menu-bullet">
                          <span class="bullet bullet-dot"></span>
                        </span>
                        <span class="menu-title">Profile</span>
                      </a>
                      <!--end:Menu link-->
                    </div>
                    <!--end:Menu item-->
                    <!--begin:Menu item-->
                    <div class="menu-item">
                      <!--begin:Menu link-->
                      <a class="menu-link" href="galaxy/publications.html">
                        <span class="menu-bullet">
                          <span class="bullet bullet-dot"></span>
                        </span>
                        <span class="menu-title">Publications</span>
                      </a>
                      <!--end:Menu link-->
                    </div>
                    <!--end:Menu item-->
                    <!--begin:Menu item-->
                    <div class="menu-item">
                      <!--begin:Menu link-->
                      <a class="menu-link" href="galaxy/grants.html">
                        <span class="menu-bullet">
                          <span class="bullet bullet-dot"></span>
                        </span>
                        <span class="menu-title">Grants</span>
                      </a>
                      <!--end:Menu link-->
                    </div>
                    <!--end:Menu item-->
                    <!--begin:Menu item-->
                    <div class="menu-item">
                      <!--begin:Menu link-->
                      <a class="menu-link" href="galaxy/projects.html">
                        <span class="menu-bullet">
                          <span class="bullet bullet-dot"></span>
                        </span>
                        <span class="menu-title">Projects</span>
                      </a>
                      <!--end:Menu link-->
                    </div>
                    <!--end:Menu item-->
                    <!--begin:Menu item-->
                    <div class="menu-item">
                      <!--begin:Menu link-->
                      <a class="menu-link" href="galaxy/compliance.html">
                        <span class="menu-bullet">
                          <span class="bullet bullet-dot"></span>
                        </span>
                        <span class="menu-title">Compliance</span>
                      </a>
                      <!--end:Menu link-->
                    </div>
                    <!--end:Menu item-->
                  </div>
                  <!--end:Menu sub-->
                </div>
                <!--end:Menu item-->
              </div>
              <!--end::Sidebar menu-->
              <!--begin::Footer-->
              <div class="app-sidebar-project-default app-sidebar-project-minimize text-center min-h-lg-400px flex-column-auto d-flex flex-column justify-content-end" id="kt_app_sidebar_footer">
                <!--begin::Illustration-->
                <img class="mx-auto mb-10" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-fav.png" style="padding:30px; width:50%">
                <!--end::Illustration-->
              </div>
              <!--end::Footer-->
            </div>
            <!--end::Main-->
          </div>
          <!--end::Sidebar-->
      <!--begin::Main-->
      <div class="app-main flex-column flex-row-fluid" id="kt_app_main">
        <div class="d-flex flex-column flex-column-fluid">
          <div id="kt_app_toolbar" class="app-toolbar pt-5">
            <div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
              <div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
                <div class="page-title d-flex flex-column gap-1 me-3 mb-2">
                  <ul class="breadcrumb breadcrumb-separatorless fw-semibold mb-6">
                    <li class="breadcrumb-item text-gray-700 fw-bold lh-1"><a href="index.html" class="text-gray-500"><i class="ki-duotone ki-home fs-3 text-gray-400 me-n1"></i></a></li>
                    <li class="breadcrumb-item"><i class="ki-duotone ki-right fs-4 text-gray-700 mx-n1"></i></li>
                    <li class="breadcrumb-item text-gray-700 fw-bold lh-1">Galaxy</li>
                    <li class="breadcrumb-item"><i class="ki-duotone ki-right fs-4 text-gray-700 mx-n1"></i></li>
                    <li class="breadcrumb-item text-gray-700">Publications</li>
                  </ul>
                  <h1 class="page-heading d-flex flex-column justify-content-center text-dark fw-bolder fs-1 lh-0">Publications Dashboard</h1>
                </div>
                <button id="editToggle" class="btn btn-sm btn-success ms-3 px-4 py-3">Edit</button>
              </div>
            </div>
          </div>

          <!--begin::Content-->
          <div id="kt_app_content" class="app-content flex-column-fluid">
            <div id="kt_app_content_container" class="app-container container-fluid">

              <div class="row g-6">
                <!-- MAIN -->
                <div class="col-xl-8">
                  <!-- Publications -->
                  <div class="card card-3d h-100">
                    <div class="card-header align-items-center">
                      <h3 class="card-title fw-bold m-0">Publications</h3>
                    </div>
                    <div class="card-body">
                      <div id="publications_editor" class="d-none mb-5">
                        <div class="row g-3">
                          <div class="col-md-6"><input class="form-control" placeholder="Title" id="pub_title" /></div>
                          <div class="col-md-6"><input class="form-control" placeholder="Authors" id="pub_authors" /></div>
                          <div class="col-md-4"><input class="form-control" placeholder="Journal" id="pub_journal" /></div>
                          <div class="col-md-2"><input class="form-control" placeholder="Year" id="pub_year" /></div>
                          <div class="col-md-6"><input class="form-control" placeholder="Tags (comma-sep)" id="pub_tags" /></div>
                          <div class="col-md-6"><input class="form-control" placeholder="DOI or URL" id="pub_doi" /></div>
                          <div class="col-md-6"><input class="form-control" placeholder="PDF link" id="pub_pdf" /></div>
                          <div class="col-md-3"><input class="form-control" placeholder="Status" id="pub_status" /></div>
                          <div class="col-md-3"><input class="form-control" placeholder="Citations" id="pub_citations" /></div>
                          <div class="col-12"><button class="btn btn-primary" id="pub_add_btn">Add publication</button></div>
                        </div>
                      </div>

                      <div id="publications_list" class="vstack gap-4">
                        <div class="publication-item">
                          <div class="fw-semibold">—</div>
                          <div class="text-gray-400 mt-2">No publications yet.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- RIGHT RAIL -->
                <div class="col-xl-4">
                  <!-- Metrics -->
                  <div class="card card-3d mb-6">
                    <div class="card-header align-items-center">
                      <h3 class="card-title fw-bold m-0">Metrics</h3>
                      <div class="card-toolbar"><a href="#" class="btn btn-sm btn-light">See All</a></div>
                    </div>
                    <div class="card-body">
                      <ul id="metrics_list" class="ps-7 mb-0">
                        <li>Total Publications: <span class="fw-bold" id="m_totalPubs">0</span></li>
                        <li>Total Citations: <span class="fw-bold" id="m_totalCites">0</span></li>
                        <li>Average Citations: <span class="fw-bold" id="m_avgCites">0</span></li>
                        <li>h-index: <span class="fw-bold" id="m_hIndex">0</span></li>
                        <li>i10-index: <span class="fw-bold" id="m_i10Index">0</span></li>
                      </ul>
                    </div>
                  </div>

                  <!-- Top-Cited -->
                  <div class="card card-3d mb-6">
                    <div class="card-header align-items-center">
                      <h3 class="card-title fw-bold m-0">Top-Cited</h3>
                      <div class="card-toolbar"><a href="#" class="btn btn-sm btn-light">See All</a></div>
                    </div>
                    <div class="card-body">
                      <ul id="top_cited_list" class="ps-7 mb-0">
                        <li class="text-gray-400">—</li>
                      </ul>
                    </div>
                  </div>

                  <!-- Research Topics -->
                  <div class="card card-3d" id="research_topics_card">
                    <div class="card-header align-items-center">
                      <h3 class="card-title fw-bold m-0">Research Topics</h3>
                      <div class="card-toolbar">
                        <span class="badge badge-light">Click to expand</span>
                      </div>
                    </div>
                    <div class="card-body">
                      <!-- keep for fallback parsing (hidden by CSS) -->
                      <div id="research_topics_tags" class="d-flex flex-wrap gap-2">
                        <span class="badge badge-light text-gray-500">—</span>
                      </div>

                      <!-- the cloud fills the entire card body -->
                      <div id="rt_cloud_container">
                        <canvas id="rt_wordcloud" aria-label="Research topics word cloud"></canvas>
                      </div>

                      <div id="rt_wordcloud_legend"></div>
                    </div>
                  </div>
                </div>
              </div><!-- /row -->

            </div>
          </div>
          <!--end::Content-->
        </div>

        <!--begin::Footer-->
        <div id="kt_app_footer" class="app-footer align-items-center justify-content-center justify-content-md-between flex-column flex-md-row py-3">
          <div class="text-dark order-2 order-md-1">
            <span class="text-muted fw-semibold me-1">2025&copy;</span>
            <a href="/" class="text-gray-800 text-hover-primary">Masterly Galaxy</a>
          </div>
          <div class="text-dark order-2 order-md-1 center-block">
            <span class="fw-semibold">Made with <i class="fa fa-heart text-danger"></i> by Masterly Inc.</span>
          </div>
          <ul class="menu menu-gray-600 menu-hover-primary fw-semibold order-1">
            <li class="menu-item"><a href="https://masterly.ca/" target="_blank" class="menu-link px-2">About</a></li>
            <li class="menu-item"><a href="mailto:support@masterly.ca/" target="_blank" class="menu-link px-2">Support</a></li>
            <li class="menu-item"><a href="/terms-and-conditions" class="menu-link px-2" target="_blank">Terms & Conditions</a></li>
            <li class="menu-item"><a href="/privacy-policy" class="menu-link px-2" target="_blank">Privacy Policy</a></li>
          </ul>
        </div>
        <!--end::Footer-->
      </div>
      <!--end:::Main-->

      <!--begin::aside-->
      <div id="kt_app_aside" class="app-aside flex-column" data-kt-drawer="true" data-kt-drawer-name="app-aside" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="auto" data-kt-drawer-direction="end" data-kt-drawer-toggle="#kt_app_aside_mobile_toggle">
        <div id="kt_app_aside_wrapper" class="d-flex flex-column align-items-center hover-scroll-y py-5 py-lg-0 gap-4 d-lg-flex" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_header" data-kt-scroll-wrappers="#kt_app_aside_wrapper" data-kt-scroll-offset="5px">
          <a href="https://core.masterly.ca/settings/profile" class="btn btn-icon btn-color-muted bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Profile" data-bs-custom-class="tooltip-inverse" id="js-aside-profile">
            <i class="ki-duotone ki-user fs-2qx"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>
          </a>
          <a href="https://findware.masterly.ca/my-dashboard" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4 d-lg-none" data-bs-toggle="tooltip" title="Findware" data-bs-custom-class="tooltip-inverse">
            <img src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/findware.svg" class="h-45px w-45px" />
          </a>
          <a href="https://sos.masterly.ca/my-dashboard" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4 d-lg-none" data-bs-toggle="tooltip" title="Masterly SOS" data-bs-custom-class="tooltip-inverse">
            <img src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/sos.svg" class="h-45px w-45px" />
          </a>
          <a href="https://core.masterly.ca/settings/contacts" class="btn btn-icon btn-color-info bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Contacts" data-bs-custom-class="tooltip-inverse">
            <i class="ki-duotone ki-book fs-2qx"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span></i>
          </a>
          <a href="https://core.masterly.ca/settings/security" class="btn btn-icon btn-color-primary bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Security" data-bs-custom-class="tooltip-inverse">
            <i class="ki-duotone ki-key fs-2qx"><span class="path1"></span><span class="path2"></span></i>
          </a>
          <a href="https://core.masterly.ca/settings/sessions" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Sessions" data-bs-custom-class="tooltip-inverse">
            <i class="ki-duotone ki-user-tick fs-2qx"><span class="path1"></span><span class="path2"></span><span class="path3"></span></i>
          </a>
          <a href="/sign-out" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Sign out" data-bs-custom-class="tooltip-inverse">
            <i class="ki-duotone ki-exit-right fs-2qx"><span class="path1"></span><span class="path2"></span></i>
          </a>
        </div>
      </div>
      <!--end::aside-->
    </div>
  </div>
</div>

<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
  <i class="ki-duotone ki-arrow-up"><span class="path1"></span><span class="path2"></span></i>
</div>

<script>var hostUrl="assets/";</script>
<script src="assets/plugins/global/plugins.bundle.js"></script>
<script src="assets/js/scripts.bundle.js"></script>
<script src="assets/plugins/custom/datatables/datatables.bundle.js"></script>

<!-- your existing page logic (unchanged) -->
<script src="assets/js/custom/galaxy/publications.js" type="module"></script>

<!-- Word cloud renderer: counts tag occurrences; fills card without overflow -->
<script>
(function(){
  const pubList = document.getElementById('publications_list');
  const fallbackList = document.getElementById('research_topics_tags');
  const container = document.getElementById('rt_cloud_container');
  const canvas = document.getElementById('rt_wordcloud');
  if(!container || !canvas) return;
  const ctx = canvas.getContext('2d');
  let vw = 0, vh = 0;

  const stopWords = new Set(("a,an,and,the,of,for,in,on,with,by,to,from,into,using,via,at,as,over,under,between,within,without,toward,against,new,study,approach,method,methods,analysis,model,models,system,systems,framework,design,case,data").split(','));

  const splitMaybeList = (t)=>{
    const raw=(t||'').trim().toLowerCase();
    if(!raw) return [];
    return (/[,\|;#·•]/.test(raw) ? raw.split(/[,\|;#·•]+/) : raw.split(/\s+/))
      .map(s=>s.trim()).filter(Boolean);
  };
  const isValidTopic = (s)=>{
    if(!s) return false;
    const t=s.trim().toLowerCase();
    return t && !stopWords.has(t) && !t.includes('citation') &&
           !/^[x×]?\d+$/.test(t) && !/^\d{4}$/.test(t) && /[a-z]/.test(t);
  };

  function collectTopics(){
    const counts=new Map();

    if(pubList){
      pubList.querySelectorAll('[data-tags]').forEach(el=>{
        splitMaybeList(el.getAttribute('data-tags')).forEach(t=>{
          if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1);
        });
      });
      pubList.querySelectorAll('.badge,.chip,.tag,[data-topic],[data-tag]').forEach(el=>{
        const txt=el.getAttribute('data-topic')||el.getAttribute('data-tag')||el.textContent||'';
        splitMaybeList(txt).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
      });
    }

    if(counts.size===0 && fallbackList){
      const chips=fallbackList.querySelectorAll('.badge,.chip,.tag,[data-topic]');
      if(chips.length){
        chips.forEach(el=>{
          const txt=el.getAttribute('data-topic')||el.textContent||'';
          splitMaybeList(txt).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
        });
      }else{
        splitMaybeList(fallbackList.textContent).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
      }
    }

    return Array.from(counts,([text,count])=>({text,count}))
      .sort((a,b)=>b.count-a.count)
      .slice(0,80);
  }

  function drawCloud(){
    const words = collectTopics();
    ctx.clearRect(0, 0, vw, vh);
    if(!words.length) return;

    const max = words[0].count, min = words[words.length-1].count;
    const fontSize = w => max===min ? Math.round(vh*0.08)
                                    : Math.round(vh*(0.04 + (w.count-min)/(max-min)*0.12));

    const placed = [];
    const center = { x: vw/2, y: vh/2 };
    const collides = a => placed.some(b => !(a.x+a.w<b.x || b.x+b.w<a.x || a.y+a.h<b.y || b.y+b.h<a.y));

    words.forEach(w=>{
      const size = fontSize(w);
      ctx.font = "600 " + size + "px Inter, system-ui, sans-serif";
      const m = ctx.measureText(w.text);
      const bw = m.width, bh = size;

      let ang = 0, rad = 0, box = null;
      for (let tries=0; tries<3000; tries++){
        ang += 0.22; rad += 0.8;
        const x = Math.round(center.x + Math.cos(ang)*rad - bw/2);
        const y = Math.round(center.y + Math.sin(ang)*rad - bh/2);
        const cand = { x, y, w: bw, h: bh };
        if (x<2 || y<2 || x+bw>vw-2 || y+bh>vh-2) continue;
        if (!collides(cand)) { box=cand; break; }
      }
      if (box){
        const hue=(w.text.charCodeAt(0)*37 + w.text.length*17)%360;
        ctx.fillStyle = `hsl(${hue} 70% 60%)`;
        ctx.fillText(w.text, box.x, box.y + box.h*0.85);
        placed.push(box);
      }
    });
  }

  function fit(){
    const rect = container.getBoundingClientRect();
    const w = Math.max(1, Math.floor(rect.width));
    const h = Math.max(1, Math.floor(rect.height));
    const dpr = window.devicePixelRatio || 1;

    canvas.width  = Math.round(w * dpr);
    canvas.height = Math.round(h * dpr);

    ctx.setTransform(dpr,0,0,dpr,0,0);
    vw = w; vh = h;

    drawCloud();
  }

  new ResizeObserver(fit).observe(container);
  if(pubList){ new MutationObserver(fit).observe(pubList,{childList:true,subtree:true,characterData:true}); }
  if(fallbackList){ new MutationObserver(fit).observe(fallbackList,{childList:true,subtree:true,characterData:true}); }
  fit();
  window.addEventListener('resize', fit, { passive:true });
  window.addEventListener('orientationchange', fit, { passive:true });
  document.addEventListener('transitionend', (e) => {
    if (e.target && (e.target.id === 'kt_app_sidebar' || e.target.id === 'kt_app_header')) {
      setTimeout(fit, 50);
    }
  }, true);
})();
</script>
<script>
(function(){
  const smallContainer = document.getElementById('rt_cloud_container');
  const modal = document.getElementById('rt_modal');
  const modalClose = document.getElementById('rt_modal_close');
  const modalContainer = document.getElementById('rt_modal_container');
  const modalCanvas = document.getElementById('rt_modal_canvas');
  if(!smallContainer || !modal || !modalContainer || !modalCanvas) return;

  const mctx = modalCanvas.getContext('2d');
  let mvw = 0, mvh = 0;

  const pubList = document.getElementById('publications_list');
  const fallbackList = document.getElementById('research_topics_tags');
  const stopWords = new Set(("a,an,and,the,of,for,in,on,with,by,to,from,into,using,via,at,as,over,under,between,within,without,toward,against,new,study,approach,method,methods,analysis,model,models,system,systems,framework,design,case,data").split(','));
  const splitMaybeList = (t)=>{ const raw=(t||'').trim().toLowerCase(); if(!raw) return []; return (/[,\|;#·•]/.test(raw)? raw.split(/[,\|;#·•]+/): raw.split(/\s+/)).map(s=>s.trim()).filter(Boolean); };
  const isValidTopic = (s)=>{ if(!s) return false; const t=s.trim().toLowerCase(); return t && !stopWords.has(t) && !t.includes('citation') && !/^[x×]?\d+$/.test(t) && !/^\d{4}$/.test(t) && /[a-z]/.test(t); };
  function collectTopics(){
    const counts=new Map();
    if(pubList){
      pubList.querySelectorAll('[data-tags]').forEach(el=>{
        splitMaybeList(el.getAttribute('data-tags')).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
      });
      pubList.querySelectorAll('.badge,.chip,.tag,[data-topic],[data-tag]').forEach(el=>{
        const txt=el.getAttribute('data-topic')||el.getAttribute('data-tag')||el.textContent||'';
        splitMaybeList(txt).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
      });
    }
    if(counts.size===0 && fallbackList){
      const chips=fallbackList.querySelectorAll('.badge,.chip,.tag,[data-topic]');
      if(chips.length){
        chips.forEach(el=>{
          const txt=el.getAttribute('data-topic')||el.textContent||'';
          splitMaybeList(txt).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
        });
      }else{
        splitMaybeList(fallbackList.textContent).forEach(t=>{ if(isValidTopic(t)) counts.set(t,(counts.get(t)||0)+1); });
      }
    }
    return Array.from(counts,([text,count])=>({text,count})).sort((a,b)=>b.count-a.count).slice(0,120);
  }

  function drawModalCloud(){
    const words = collectTopics();
    mctx.clearRect(0,0,mvw,mvh);
    if(!words.length) return;

    const max=words[0].count, min=words[words.length-1].count;
    const fontSize = w => max===min ? Math.round(mvh*0.08)
                                    : Math.round(mvh*(0.03 + (w.count-min)/(max-min)*0.14));
    const placed=[]; const center={x: mvw/2, y: mvh/2};
    const collides=a=>placed.some(b => !(a.x+a.w<b.x || b.x+b.w<a.x || a.y+a.h<b.y || b.y+b.h<a.y));

    words.forEach(w=>{
      const size=fontSize(w);
      mctx.font = "600 " + size + "px Inter, system-ui, sans-serif";
      const m = mctx.measureText(w.text);
      const bw=m.width, bh=size;
      let ang=0, rad=0, box=null;
      for(let tries=0; tries<4000; tries++){
        ang+=0.2; rad+=1.0;
        const x = Math.round(center.x + Math.cos(ang)*rad - bw/2);
        const y = Math.round(center.y + Math.sin(ang)*rad - bh/2);
        const cand={x,y,w:bw,h:bh};
        if(x<4 || y<4 || x+bw>mvw-4 || y+bh>mvh-4) continue;
        if(!collides(cand)){ box=cand; break; }
      }
      if(box){
        const hue=(w.text.charCodeAt(0)*37 + w.text.length*17)%360;
        mctx.fillStyle=`hsl(${hue} 70% 60%)`;
        mctx.fillText(w.text, box.x, box.y + box.h*0.85);
        placed.push(box);
      }
    });
  }

  function fitModal(){
    const rect = modalContainer.getBoundingClientRect();
    const w = Math.max(1, Math.floor(rect.width));
    const h = Math.max(1, Math.floor(rect.height));
    const dpr = window.devicePixelRatio || 1;
    modalCanvas.width  = Math.round(w*dpr);
    modalCanvas.height = Math.round(h*dpr);
    mctx.setTransform(dpr,0,0,dpr,0,0);
    mvw=w; mvh=h;
    drawModalCloud();
  }

  function openModal(){
    modal.classList.add('is-open');
    document.body.classList.add('rt-modal-open');
    requestAnimationFrame(()=>{ fitModal(); });
  }
  function closeModal(){
    modal.classList.remove('is-open');
    document.body.classList.remove('rt-modal-open');
  }

  smallContainer.addEventListener('click', openModal);
  modalClose.addEventListener('click', closeModal);
  modal.addEventListener('click', (e)=>{ if(e.target.classList.contains('rt-modal__backdrop')) closeModal(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal.classList.contains('is-open')) closeModal(); });

  window.addEventListener('resize', ()=>{ if(modal.classList.contains('is-open')) fitModal(); }, {passive:true});
  window.addEventListener('orientationchange', ()=>{ if(modal.classList.contains('is-open')) fitModal(); }, {passive:true});
})();
</script>
</body>
</html>