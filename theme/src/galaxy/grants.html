<!DOCTYPE html>
<html lang="en">
	<!--begin::Head-->
	<head>
		<base href="../../" />
			<title>Masterly Galaxy | Galaxy Dashboard</title>

		<meta charset="utf-8" />
		<meta name="description" content="Masterly Galaxy" />
		<meta name="keywords" content="masterly galaxy" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<link rel="shortcut icon" href="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-fav.png" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
		<link href="/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/style.masterly.css" rel="stylesheet" type="text/css" />
		<link href="/assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_app_body" data-kt-app-header-fixed="true" data-kt-app-header-fixed-mobile="true" data-kt-app-sidebar-enabled="true" data-kt-app-sidebar-fixed="true" data-kt-app-sidebar-hoverable="true" data-kt-app-sidebar-push-toolbar="true" data-kt-app-sidebar-push-footer="true" data-kt-app-toolbar-enabled="true" data-kt-app-aside-enabled="true" data-kt-app-aside-fixed="true" data-kt-app-aside-push-toolbar="true" data-kt-app-aside-push-footer="true" class="app-default">
		<!--begin::Theme mode setup on page load-->
		<script>var defaultThemeMode = "light"; var themeMode; if ( document.documentElement ) { if ( document.documentElement.hasAttribute("data-bs-theme-mode")) { themeMode = document.documentElement.getAttribute("data-bs-theme-mode"); } else { if ( localStorage.getItem("data-bs-theme") !== null ) { themeMode = localStorage.getItem("data-bs-theme"); } else { themeMode = defaultThemeMode; } } if (themeMode === "system") { themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"; } document.documentElement.setAttribute("data-bs-theme", themeMode); }</script>
		<!--end::Theme mode setup on page load-->
		<!--begin::App-->
		<div class="d-flex flex-column flex-root app-root" id="kt_app_root">
			<!--begin::Page-->
			<div class="app-page flex-column flex-column-fluid" id="kt_app_page">
				<!--begin::Header-->
				<div id="kt_app_header" class="app-header d-flex flex-column flex-stack">
					<!--begin::Header main-->
					<div class="d-flex align-items-center flex-stack flex-grow-1">
						<div class="app-header-logo d-flex align-items-center flex-stack px-lg-11 mb-2" id="kt_app_header_logo">
							<!--begin::Sidebar mobile toggle-->
							<div class="btn btn-icon btn-active-color-primary w-35px h-35px ms-3 me-5 d-flex d-lg-none" id="kt_app_sidebar_mobile_toggle">
								<i class="ki-solid ki-abstract-14 fs-2tx"></i>
							</div>

							<!--begin::Logo-->
							<a href="https://core.masterly.ca/" class="app-sidebar-logo">
								<img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-light-show d-lg-none" style="width:70%" />
								<img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-light-show d-lg-block d-none" style="width:95%" />
								<img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-dark-show" style="width:100%" />
							</a>

							<!--begin::Sidebar toggle-->
							<div id="kt_app_sidebar_toggle" class="app-sidebar-toggle btn btn-sm btn-icon btn-color-gray-600 btn-active-color-dark me-n2 d-none d-lg-flex" data-kt-toggle="true" data-kt-toggle-state="active" data-kt-toggle-target="body" data-kt-toggle-name="app-sidebar-minimize" onclick="toggleSidebarIcon(this)" title="Click to toggle the sidebar">
								<i class="ki-duotone ki-element-7 fs-2x">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</div>
							<!--end::Sidebar toggle-->
						</div>
						<!--begin::Navbar-->
						<div class="app-navbar flex-grow-1 justify-content-end" id="kt_app_header_navbar">

							<!--search-->
							<div class="app-navbar-item d-flex align-items-stretch flex-lg-grow-1 me-2 me-lg-0">
								<div class="header-search d-flex align-items-center w-lg-350px" data-kt-search-keypress="true" data-kt-search-min-length="2" data-kt-search-enter="enter" data-kt-search-layout="menu" data-kt-search-responsive="true" data-kt-menu-trigger="auto" data-kt-menu-permanent="true" data-kt-menu-placement="bottom-start">
									<div class="d-none d-lg-block w-100 position-relative mb-5 mb-lg-0" autocomplete="off">
										<select data-control="select2" data-placeholder="Select a Masterly Service" class="form-select form-select-lg fw-semibold border-0 h-lg-40px" id="js-masterly-product-select">
											<option></option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/findware.svg" value="1">FindWare</option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/sos.svg" value="2">SOS</option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/forms.svg" value="3">Forms</option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/orbit.svg" value="4">Orbit</option>
										</select>
									</div>
									<span class="badge badge-danger ms-5" id="js-product-free-trial-badge" style="display:none">free trial</span>
								</div>
							</div>

							<!--Header menu toggle-->
							<div class="app-navbar-item ms-3 ms-lg-4 ms-n2 me-3 d-flex d-lg-none">
								<div class="btn btn-icon btn-active-color-dark w-35px h-35px ms-3 me-2 d-flex d-lg-none" id="kt_app_aside_mobile_toggle">
									<i class="ki-solid ki-dots-vertical" style="font-size:30px; font-weight:bold"></i>
								</div>
							</div>


						</div>
						<!--end::Navbar-->
					</div>
					<!--end::Header main-->
					<!--begin::Separator-->
					<div class="app-header-separator"></div>
					<!--end::Separator-->
				</div>
				<!--end::Header-->
				<!--begin::Wrapper-->
				<div class="app-wrapper flex-column flex-row-fluid" id="kt_app_wrapper">
					<!--begin::Sidebar-->
					<div id="kt_app_sidebar" class="app-sidebar flex-column" data-kt-drawer="true" data-kt-drawer-name="app-sidebar" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="250px" data-kt-drawer-direction="start" data-kt-drawer-toggle="#kt_app_sidebar_mobile_toggle">
						<!--begin::Main-->
						<div class="d-flex flex-column justify-content-between h-100 hover-scroll-overlay-y my-2 d-flex flex-column" id="kt_app_sidebar_main" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_header" data-kt-scroll-wrappers="#kt_app_main" data-kt-scroll-offset="5px">
							<!--begin::Sidebar menu-->
							<div id="#kt_app_sidebar_menu" data-kt-menu="true" data-kt-menu-expand="false" class="flex-column-fluid menu menu-sub-indention menu-column menu-rounded menu-active-bg mb-7">
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="https://core.masterly.ca/dashboard" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-home fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">Masterly Home</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="index.html" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-element-11 fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">Dashboard</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="https://core.masterly.ca/settings/profile" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-user fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">My profile</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="https://core.masterly.ca/get-started" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-information-4 fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">Tutorials</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div data-kt-menu-trigger="click" class="menu-item here show menu-accordion">
									<!--begin:Menu link-->
									<span class="menu-link">
										<span class="menu-icon">
											<i class="ki-duotone ki-note-2 fs-1">
												<span class="path1"></span>
												<span class="path2"></span>
												<span class="path3"></span>
 												<span class="path4"></span>
											</i>
										</span>
										<span class="menu-title">Galaxy</span>
										<span class="menu-arrow"></span>
									</span>
									<!--end:Menu link-->
									<!--begin:Menu sub-->
									<div class="menu-sub menu-sub-accordion">
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/profile.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Profile</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/publications.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Publications</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/grants.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Grants</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/projects.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Projects</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/compliance.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Compliance</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
									</div>
									<!--end:Menu sub-->
								</div>
								<!--end:Menu item-->
							</div>
							<!--end::Sidebar menu-->
							<!--begin::Footer-->
							<div class="app-sidebar-project-default app-sidebar-project-minimize text-center min-h-lg-400px flex-column-auto d-flex flex-column justify-content-end" id="kt_app_sidebar_footer">
								<!--begin::Illustration-->
								<img class="mx-auto mb-10" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-fav.png" style="padding:30px; width:50%">
								<!--end::Illustration-->
							</div>
							<!--end::Footer-->
						</div>
						<!--end::Main-->
					</div>
					<!--end::Sidebar-->
					<!--begin::Main-->
					<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
						<!--begin::Content wrapper-->
						<div class="d-flex flex-column flex-column-fluid">
							<!--begin::Toolbar-->
							<div id="kt_app_toolbar" class="app-toolbar pt-5">
								<!--begin::Toolbar container-->
								<div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
									<!--begin::Toolbar wrapper-->
									<div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
										<!--begin::Page title-->
										<div class="page-title d-flex flex-column gap-1 me-3 mb-2">
											<!--begin::Breadcrumb-->
											<ul class="breadcrumb breadcrumb-separatorless fw-semibold mb-6">
												<!--begin::Item-->
												<li class="breadcrumb-item text-gray-700 fw-bold lh-1">
													<a href="index.html" class="text-gray-500">
														<i class="ki-duotone ki-home fs-3 text-gray-400 me-n1"></i>
													</a>
												</li>
												<!--end::Item-->
												<!--begin::Item-->
												<li class="breadcrumb-item">
													<i class="ki-duotone ki-right fs-4 text-gray-700 mx-n1"></i>
												</li>
												<!--end::Item-->
												<!--begin::Item-->
												<li class="breadcrumb-item text-gray-700 fw-bold lh-1">Galaxy</li>
												<!--end::Item-->
												<!--begin::Item-->
												<li class="breadcrumb-item">
													<i class="ki-duotone ki-right fs-4 text-gray-700 mx-n1"></i>
												</li>
												<!--end::Item-->
												<!--begin::Item-->
												<li class="breadcrumb-item text-gray-700">Grants</li>
												<!--end::Item-->
											</ul>
											<!--end::Breadcrumb-->
											<!--begin::Title-->
											<h1 class="page-heading d-flex flex-column justify-content-center text-dark fw-bolder fs-1 lh-0">Grants</h1>
											<!--end::Title-->
										</div>
										<!--end::Page title-->
										<!--begin::Actions-->
										<button id="editToggle" class="btn btn-sm btn-success ms-3 px-4 py-3">Edit Mode: OFF</button>
										<!--end::Actions-->
									</div>
									<!--end::Toolbar wrapper-->
								</div>
								<!--end::Toolbar container-->
							</div>
							<!--end::Toolbar-->
							<!--begin::Content-->
							<div id="kt_app_content" class="app-content flex-column-fluid">
							<!--begin::Content container-->
							<div id="kt_app_content_container" class="app-container container-fluid">

								<style>
								/* Enhanced card styling - monochrome, no 3D lift */
								.card-3d{
									border:1px solid rgba(255,255,255,.12);
									background:linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.03) 100%);
									box-shadow:
										0 8px 32px rgba(0,0,0,.18),
										0 2px 8px rgba(0,0,0,.12),
										inset 0 1px 0 rgba(255,255,255,.1),
										inset 0 -1px 0 rgba(0,0,0,.1);
									border-radius:20px;
									transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
									position: relative;
									overflow: hidden;
								}
								
								.card-3d:hover{ 
									box-shadow:
										0 12px 40px rgba(0,0,0,.22),
										0 4px 12px rgba(0,0,0,.15),
										inset 0 1px 0 rgba(255,255,255,.15);
									border-color: rgba(255,255,255,.18);
								}
								
								.card-3d .card-header{ 
									border-bottom:1px solid rgba(255,255,255,.1); 
									background: rgba(255,255,255,.03);
									padding: 1.5rem 1.75rem;
								}
								
								.card-3d .card-header h3 {
									font-size: 1.1rem;
									letter-spacing: 0.02em;
								}
								
								.card-3d .card-header .card-title::before {
									content: '';
									display: inline-block;
									width: 4px;
									height: 20px;
									background: rgba(255,255,255,.3);
									margin-right: 12px;
									border-radius: 2px;
									vertical-align: middle;
								}
								
								.card-3d .card-body {
									padding: 1.75rem;
								}

								/* Subtle glow on hover */
								.card-3d::after {
									content: '';
									position: absolute;
									top: 50%;
									left: 50%;
									width: 300px;
									height: 300px;
									background: radial-gradient(circle, rgba(255,255,255,.05) 0%, transparent 70%);
									transform: translate(-50%, -50%);
									opacity: 0;
									transition: opacity .3s ease;
									pointer-events: none;
								}
								
								.card-3d:hover::after {
									opacity: 1;
								}

								/* ===== COMPLIANCE-STYLE BREAKDOWN ===== */
								.donut-wrap {
									position: relative;
									width: 160px;
									height: 160px;
									margin: 0 auto;
								}

								.donut {
									transform: rotate(-90deg);
								}

								.donut circle.track {
									stroke: rgba(255,255,255,.12);
								}

								.donut circle.meter {
									stroke-linecap: round;
									transition: stroke-dasharray .6s ease;
								}

								.donut-center {
									position: absolute;
									inset: 0;
									display: flex;
									align-items: center;
									justify-content: center;
									flex-direction: column;
								}

								.donut-center .big {
									font-size: 1.5rem;
									font-weight: 800;
									line-height: 1;
								}

								.donut-center .small {
									font-size: .7rem;
									opacity: .8;
									margin-top: 4px;
								}

								.mini-bar {
									height: 8px;
									border-radius: 999px;
									background: rgba(255,255,255,.12);
									overflow: hidden;
								}

								.mini-bar>span {
									display: block;
									height: 100%;
									width: 0%;
									transition: width .6s ease;
									border-radius: 999px;
								}

								.bar-blue>span {
									background: hsl(210 85% 60%);
								}

								.bar-yellow>span {
									background: hsl(50 85% 60%);
								}

								.bar-red>span {
									background: hsl(10 85% 60%);
								}

								.summary-bars{
									max-width: 360px;
									width: 100%;
									margin: 0 auto;
								}
								
								/* Editable cells */
								.editable-cell { cursor: pointer; position: relative; }
								.editable-cell:hover { background: rgba(255,255,255,.05); }
								.editable-cell input { 
									width: 100%; 
									border: 1px solid #4caf50; 
									background: rgba(76,175,80,.1); 
									padding: 4px 8px; 
									border-radius: 4px; 
								}
								</style>

								<div class="row g-6">
								<!-- LEFT/MIDDLE (xl:8 cols) -->
								<div class="col-xl-8">
									<!-- Stat tiles row -->
									<div class="row g-6 mb-6">
									<div class="col-md-6">
										<div class="card card-3d h-100">
										<div class="card-header"><h3 class="card-title fw-bold m-0">Total Grants Awarded</h3></div>
										<div class="card-body">
											<div class="fw-bold fs-3" id="total_grants_awarded">—</div>
											<div class="text-gray-400 fs-7">Total amount awarded</div>
										</div>
										</div>
									</div>
									<div class="col-md-6">
										<div class="card card-3d h-100">
										<div class="card-header"><h3 class="card-title fw-bold m-0">Available Budget</h3></div>
										<div class="card-body">
											<div class="fw-bold fs-3" id="available_budget">—</div>
											<div class="text-gray-400 fs-7">Money received minus spent</div>
										</div>
										</div>
									</div>
									</div>

									<!-- All Grants Table -->
									<div class="card card-3d mb-6">
									<div class="card-header">
										<h3 class="card-title fw-bold m-0">All Grants</h3>
										<div class="card-toolbar">
											<span class="badge badge-light-primary" id="grants_count">0 grants</span>
										</div>
									</div>
									<div class="card-body">
										<div class="table-responsive">
										<table class="table table-row-bordered table-hover align-middle gs-4 gy-3" id="grants_table">
											<thead>
											<tr class="fw-bold text-muted bg-light">
												<th class="min-w-200px">Title</th>
												<th class="min-w-150px">Agency</th>
												<th class="min-w-100px text-end">Awarded</th>
												<th class="min-w-100px text-end">Received</th>
												<th class="min-w-100px text-end">Spent</th>
												<th class="min-w-80px text-center">Status</th>
											</tr>
											</thead>
											<tbody id="grants_tbody">
											<tr>
												<td colspan="6" class="text-center text-gray-400">Loading grants...</td>
											</tr>
											</tbody>
										</table>
										</div>
									</div>
									</div>
								</div>

								<!-- RIGHT column (xl:4) -->
								<div class="col-xl-4">
									<!-- Grants Breakdown Chart -->
									<div class="card card-3d mb-6">
										<div class="card-header align-items-center">
											<h3 class="card-title fw-bold m-0">Breakdown</h3>
										</div>
										<div class="card-body">
											<div class="d-flex flex-column align-items-center gap-4">
												<!-- Donut -->
												<div class="donut-wrap">
													<svg class="donut" width="160" height="160" viewBox="0 0 160 160">
														<circle class="track" cx="80" cy="80" r="64" 
																fill="transparent" stroke-width="16"></circle>
														<circle id="summary_donut_path" class="meter" cx="80" cy="80" r="64"
																fill="transparent" stroke-width="16" 
																stroke="#22c55e" 
																stroke-dasharray="0 402"></circle>
													</svg>
													<div class="donut-center">
														<div id="summary_percent_text" class="big">0%</div>
														<div id="summary_total_text" class="small">Spent</div>
													</div>
												</div>

												<!-- Bars under donut -->
												<div class="summary-bars w-100 d-flex flex-column align-items-stretch">
													<div class="d-flex align-items-center justify-content-between">
														<div class="text-gray fs-8">Awarded</div>
														<div class="fs-6 fw-bold" id="summary_awarded">$0</div>
													</div>
													<div class="mini-bar bar-blue mb-3"><span id="bar_blue"></span></div>

													<div class="d-flex align-items-center justify-content-between">
														<div class="text-gray fs-8">Received</div>
														<div class="fs-6 fw-bold" id="summary_received">$0</div>
													</div>
													<div class="mini-bar bar-yellow mb-3"><span id="bar_yellow"></span></div>

													<div class="d-flex align-items-center justify-content-between">
														<div class="text-gray fs-8">Spent</div>
														<div class="fs-6 fw-bold" id="summary_spent">$0</div>
													</div>
													<div class="mini-bar bar-red"><span id="bar_red"></span></div>
												</div>
											</div>
										</div>
									</div>

									<!-- Reports -->
									<div class="card card-3d mb-6">
									<div class="card-header"><h3 class="card-title fw-bold m-0">Reports</h3></div>
									<div class="card-body">
										<div><strong>Grant ID:</strong> <span id="reports_grant_id">—</span></div>
										<div class="mt-2"><strong>Next Due:</strong> <span id="reports_next_due">—</span></div>
										<div class="mt-2"><strong>Last Submitted:</strong> <span id="reports_last_submitted">—</span></div>
									</div>
									</div>

									<!-- Keywords -->
									<div class="card card-3d">
									<div class="card-header"><h3 class="card-title fw-bold m-0">Keywords</h3></div>
									<div class="card-body">
										<div class="d-flex flex-wrap gap-2" id="keywords_section">
										<span class="badge bg-secondary">—</span>
										</div>
									</div>
									</div>
								</div>
								</div>

							</div>
							<!--end::Content container-->
							</div>
							<!--end::Content-->
						</div>
						<!--end::Content wrapper-->
						<!--begin::Footer-->
						<div id="kt_app_footer" class="app-footer align-items-center justify-content-center justify-content-md-between flex-column flex-md-row py-3">

							<div class="text-dark order-2 order-md-1">
								<span class="text-muted fw-semibold me-1">2025&copy;</span>
								<a href="/" class="text-gray-800 text-hover-primary">Masterly Galaxy</a>        
							</div>

							<div class="text-dark order-2 order-md-1 center-block">
								<span class="fw-semibold">Made with <i class="fa fa-heart text-danger"></i> by Masterly Inc.</span>
							</div>
							
							<ul class="menu menu-gray-600 menu-hover-primary fw-semibold order-1">
								<li class="menu-item">
									<a href="https://masterly.ca/" target="_blank" class="menu-link px-2">About</a>
								</li>
								<li class="menu-item">
									<a href="mailto:support@masterly.ca/" target="_blank" class="menu-link px-2">Support</a>
								</li>
								<li class="menu-item">
									<a href="/terms-and-conditions" class="menu-link px-2" target="_blank">Terms & Conditions</a>
								</li>
								<li class="menu-item">
									<a href="/privacy-policy" class="menu-link px-2" target="_blank">Privacy Policy</a>
								</li>
							</ul>
							
						</div>
						<!--end::Footer-->
					</div>
					<!--end:::Main-->
					<!--begin::aside-->
					<div id="kt_app_aside" class="app-aside flex-column" data-kt-drawer="true" data-kt-drawer-name="app-aside" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="auto" data-kt-drawer-direction="end" data-kt-drawer-toggle="#kt_app_aside_mobile_toggle">

						<div id="kt_app_aside_wrapper" class="d-flex flex-column align-items-center hover-scroll-y py-5 py-lg-0 gap-4 d-lg-flex" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_header" data-kt-scroll-wrappers="#kt_app_aside_wrapper" data-kt-scroll-offset="5px">

							<a href="https://core.masterly.ca/settings/profile" class="btn btn-icon btn-color-muted bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Profile" data-bs-custom-class="tooltip-inverse" id="js-aside-profile">
								<i class="ki-duotone ki-user fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
									<span class="path3"></span>
								</i>
							</a>

							<a href="https://findware.masterly.ca/my-dashboard" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4 d-lg-none" data-bs-toggle="tooltip" title="Findware" data-bs-custom-class="tooltip-inverse">
								<img src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/findware.svg" class="h-45px w-45px" />
							</a>        
							<a href="https://sos.masterly.ca/my-dashboard" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4 d-lg-none" data-bs-toggle="tooltip" title="Masterly SOS" data-bs-custom-class="tooltip-inverse">
								<img src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/sos.svg" class="h-45px w-45px" />
							</a>
							
							

							<a href="https://core.masterly.ca/settings/contacts" class="btn btn-icon btn-color-info bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Contacts" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-book fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
									<span class="path3"></span>
									<span class="path4"></span>
								</i>
							</a>
							<a href="https://core.masterly.ca/settings/security" class="btn btn-icon btn-color-primary bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Security" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-key fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</a>
							<a href="https://core.masterly.ca/settings/sessions" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Sessions" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-user-tick fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
									<span class="path3"></span>
								</i>
							</a>

							<a href="/sign-out" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Sign out" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-exit-right fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</a>
						</div>

					</div>
					<!--end::aside-->
				</div>
				<!--end::Wrapper-->
			</div>
			<!--end::Page-->
		</div>
		<!--end::App-->
		
		<!--begin::Scrolltop-->
		<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
			<i class="ki-duotone ki-arrow-up">
				<span class="path1"></span>
				<span class="path2"></span>
			</i>
		</div>
		<!--end::Scrolltop-->
		<!--begin::Modals-->
		
		<!--end::Modals-->
		<!--begin::Javascript-->
		<script>var hostUrl = "assets/";</script>

		<!-- Global JS bundle -->
		<script src="assets/plugins/global/plugins.bundle.js"></script>
		<script src="assets/js/scripts.bundle.js"></script>

		<!-- Vendors (if truly needed on this page) -->
		<script src="assets/plugins/custom/datatables/datatables.bundle.js"></script>

		<!-- Publications page logic -->
		<script src="assets/js/custom/galaxy/grants.js" type="module"></script>
		<!--end::Javascript-->
		<script type="module">
		/* ========= Grants Dashboard ========= */
		const isLocal = ['localhost','127.0.0.1','0.0.0.0'].includes(location.hostname);
		const API = isLocal ? 'http://127.0.0.1:3001/api' : '/api';
		const $ = (id)=>document.getElementById(id);

		let EDIT_MODE = false;
		let grantsData = [];

		function readCache(key){ try{ return JSON.parse(localStorage.getItem(key)||'null'); }catch{ return null; } }
		function saveCache(key, data){ try{ localStorage.setItem(key, JSON.stringify(data)); }catch{} }
		async function getJSON(url){ try{ const r = await fetch(url, {cache:'no-store'}); return r.ok ? r.json() : null; }catch{ return null; } }
		
		function nz(x){
			if (typeof x === 'string') x = x.replace(/[$,]/g,'');
			const n = Number(x);
			return Number.isFinite(n) && n > 0 ? n : 0;
		}

		function amountAwarded(g){ return nz(g.amountAwarded ?? g.amount_awarded ?? g.awarded ?? g.amount ?? g.total_amount ?? g.value ?? g.budget?.total); }
		function amountReceived(g){ return nz(g.amountReceived ?? g.amount_received ?? g.received ?? g.budget?.received); }
		function amountSpent(g){ return nz(g.amountSpent ?? g.amount_spent ?? g.spent ?? g.budget?.spent); }

		function fmtMoney(n){ return `$${Number(n||0).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2})}`; }
		function fmtMoneyShort(n){
			n = Number(n)||0; const a = Math.abs(n);
			if (a >= 1e9) return `$${(n/1e9).toFixed(1)}B`;
			if (a >= 1e6) return `$${(n/1e6).toFixed(1)}M`;
			if (a >= 1e3) return `$${(n/1e3).toFixed(1)}k`;
			return `$${n.toFixed(0)}`;
		}

		async function loadGrants(){
			const store = (window.GALAXY && window.GALAXY.data && window.GALAXY.data.grants) || null;
			if (Array.isArray(store)) return store;
			const cached = readCache('galaxy_grants');
			if (cached && Array.isArray(cached.grants)) return cached.grants;
			if (Array.isArray(cached)) return cached;
			const api = await getJSON(`${API}/grants`);
			if (api && Array.isArray(api.grants)) return api.grants;
			return Array.isArray(api) ? api : [];
		}

		function computeTotals(grants){
			const awarded  = grants.reduce((a,g)=>a + amountAwarded(g), 0);
			const received = grants.reduce((a,g)=>a + amountReceived(g), 0);
			const spent    = grants.reduce((a,g)=>a + amountSpent(g), 0);
			const available= Math.max(0, received - spent);
			return {awarded, received, spent, available};
		}

		/* ===== Render Grants Table ===== */
		function renderGrantsTable(grants){
			const tbody = $('grants_tbody');
			if(!tbody) return;

			if(!grants || grants.length === 0){
				tbody.innerHTML = '<tr><td colspan="6" class="text-center text-gray-400">No grants found</td></tr>';
				$('grants_count').textContent = '0 grants';
				return;
			}

			$('grants_count').textContent = `${grants.length} grant${grants.length !== 1 ? 's' : ''}`;

			tbody.innerHTML = grants.map((g, idx)=>{
				const awarded = amountAwarded(g);
				const received = amountReceived(g);
				const spent = amountSpent(g);

				return `<tr data-grant-index="${idx}">
					<td class="editable-cell" data-field="title">${g.title || '—'}</td>
					<td class="editable-cell" data-field="agency">${g.agency || '—'}</td>
					<td class="text-end editable-cell" data-field="amountAwarded">${fmtMoney(awarded)}</td>
					<td class="text-end editable-cell" data-field="amountReceived">${fmtMoney(received)}</td>
					<td class="text-end editable-cell" data-field="amountSpent">${fmtMoney(spent)}</td>
					<td class="text-center">
						<button class="btn btn-sm btn-icon btn-light-danger delete-grant" data-grant-index="${idx}">
							<i class="ki-duotone ki-trash fs-5"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
						</button>
					</td>
				</tr>`;
			}).join('');

			// Attach event listeners for editable cells
			tbody.querySelectorAll('.editable-cell').forEach(cell=>{
				cell.addEventListener('click', ()=>{ if(EDIT_MODE) editCell(cell); });
			});

			// Attach delete button listeners
			tbody.querySelectorAll('.delete-grant').forEach(btn=>{
				btn.addEventListener('click', ()=>{ 
					if(EDIT_MODE){
						const idx = parseInt(btn.getAttribute('data-grant-index'));
						deleteGrant(idx);
					}
				});
			});
		}

		/* ===== Edit Cell ===== */
		function editCell(cell){
			const row = cell.closest('tr');
			const grantIndex = parseInt(row.getAttribute('data-grant-index'));
			const field = cell.getAttribute('data-field');
			const currentValue = grantsData[grantIndex][field] || '';

			const input = document.createElement('input');
			input.type = 'text';
			input.value = currentValue;
			input.classList.add('form-control', 'form-control-sm');
			
			cell.innerHTML = '';
			cell.appendChild(input);
			input.focus();
			input.select();

			const saveEdit = ()=>{
				let newValue = input.value.trim();
				
				// Convert to number for amount fields
				if(field.startsWith('amount')){
					newValue = nz(newValue);
					grantsData[grantIndex][field] = newValue;
					cell.textContent = fmtMoney(newValue);
				} else {
					grantsData[grantIndex][field] = newValue;
					cell.textContent = newValue || '—';
				}
				
				saveGrantsData();
				updateDashboard();
			};

			input.addEventListener('blur', saveEdit);
			input.addEventListener('keydown', (e)=>{
				if(e.key === 'Enter'){ saveEdit(); }
				if(e.key === 'Escape'){ 
					cell.textContent = currentValue || '—'; 
				}
			});
		}

		/* ===== Delete Grant ===== */
		function deleteGrant(index){
			if(!confirm(`Are you sure you want to delete "${grantsData[index].title || 'this grant'}"?`)) return;
			
			grantsData.splice(index, 1);
			saveGrantsData();
			renderGrantsTable(grantsData);
			updateDashboard();
		}

		/* ===== Save to localStorage ===== */
		function saveGrantsData(){
			saveCache('galaxy_grants', { grants: grantsData });
			window.dispatchEvent(new CustomEvent('galaxy:grants:updated'));
		}

		/* ===== Update Dashboard Stats ===== */
		function updateDashboard(){
			const t = computeTotals(grantsData);
			
			if($('total_grants_awarded')) $('total_grants_awarded').textContent = fmtMoney(t.awarded);
			if($('available_budget')) $('available_budget').textContent = fmtMoney(t.available);

			updateGrantsSummary(t);
		}

		/* ===== Update Grants Summary - COMPLIANCE STYLE (spent vs received) ===== */
		function updateGrantsSummary(totals){
			const { awarded, received, spent } = totals;
			const total = awarded + received + spent;
			
			// Update donut - shows SPENT proportion of RECEIVED
			const donutPath = $('summary_donut_path');
			const percentText = $('summary_percent_text');
			const totalText = $('summary_total_text');
			
			if(donutPath && percentText && totalText){
				// Calculate percentage: spent / received
				const percent = received > 0 ? Math.min(100, Math.round((spent / received) * 100)) : 0;
				const circumference = 402; // 2 * π * 64
				const filled = (percent / 100) * circumference;
				
				donutPath.setAttribute('stroke-dasharray', `${filled} ${circumference}`);
				percentText.textContent = `${percent}%`;
				
				// Color the donut based on spending level
				if(percent >= 90) {
					donutPath.setAttribute('stroke', '#ef4444'); // Red - overspending/high usage
				} else if(percent >= 70) {
					donutPath.setAttribute('stroke', '#f59e0b'); // Amber - getting high
				} else {
					donutPath.setAttribute('stroke', '#22c55e'); // Green - healthy
				}
			}
			
			// Update text values
			if($('summary_awarded')) $('summary_awarded').textContent = fmtMoneyShort(awarded);
			if($('summary_received')) $('summary_received').textContent = fmtMoneyShort(received);
			if($('summary_spent')) $('summary_spent').textContent = fmtMoneyShort(spent);
			
			// Update bars - showing proportions of total budget pool
			const barBlue = $('bar_blue');
			const barYellow = $('bar_yellow');
			const barRed = $('bar_red');
			
			if(barBlue && barYellow && barRed && total > 0){
				setTimeout(()=>{
					barBlue.style.width = `${(awarded / total) * 100}%`;
					barYellow.style.width = `${(received / total) * 100}%`;
					barRed.style.width = `${(spent / total) * 100}%`;
				}, 100);
			}
		}

		/* ===== Edit Toggle ===== */
		$('editToggle')?.addEventListener('click', ()=>{
			EDIT_MODE = !EDIT_MODE;
			$('editToggle').textContent = EDIT_MODE ? 'Edit Mode: ON' : 'Edit Mode: OFF';
			$('editToggle').classList.toggle('btn-success', !EDIT_MODE);
			$('editToggle').classList.toggle('btn-danger', EDIT_MODE);
		});

		/* ===== Initialize ===== */
		async function init(){
			grantsData = await loadGrants();
			renderGrantsTable(grantsData);
			updateDashboard();
		}

		init();
		</script>
		</body>
		</html>
	<!--end::Body-->
</html>