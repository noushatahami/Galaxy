<!DOCTYPE html>
<html lang="en">
	<!--begin::Head-->
	<head>
		<base href="../../" />
			<title>Masterly Galaxy | Galaxy Dashboard</title>

		<meta charset="utf-8" />
		<meta name="description" content="Masterly Galaxy" />
		<meta name="keywords" content="masterly galaxy" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<link rel="shortcut icon" href="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-fav.png" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700" />
		<link href="/assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
		<link href="/assets/css/style.masterly.css" rel="stylesheet" type="text/css" />
		<link href="/assets/plugins/custom/datatables/datatables.bundle.css" rel="stylesheet" type="text/css" />
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_app_body" data-kt-app-header-fixed="true" data-kt-app-header-fixed-mobile="true" data-kt-app-sidebar-enabled="true" data-kt-app-sidebar-fixed="true" data-kt-app-sidebar-hoverable="true" data-kt-app-sidebar-push-toolbar="true" data-kt-app-sidebar-push-footer="true" data-kt-app-toolbar-enabled="true" data-kt-app-aside-enabled="true" data-kt-app-aside-fixed="true" data-kt-app-aside-push-toolbar="true" data-kt-app-aside-push-footer="true" class="app-default">
		<!--begin::Theme mode setup on page load-->
		<script>var defaultThemeMode = "light"; var themeMode; if ( document.documentElement ) { if ( document.documentElement.hasAttribute("data-bs-theme-mode")) { themeMode = document.documentElement.getAttribute("data-bs-theme-mode"); } else { if ( localStorage.getItem("data-bs-theme") !== null ) { themeMode = localStorage.getItem("data-bs-theme"); } else { themeMode = defaultThemeMode; } } if (themeMode === "system") { themeMode = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light"; } document.documentElement.setAttribute("data-bs-theme", themeMode); }</script>
		<!--end::Theme mode setup on page load-->
		<!--begin::App-->
		<div class="d-flex flex-column flex-root app-root" id="kt_app_root">
			<!--begin::Page-->
			<div class="app-page flex-column flex-column-fluid" id="kt_app_page">
				<!--begin::Header-->
				<div id="kt_app_header" class="app-header d-flex flex-column flex-stack">
					<!--begin::Header main-->
					<div class="d-flex align-items-center flex-stack flex-grow-1">
						<div class="app-header-logo d-flex align-items-center flex-stack px-lg-11 mb-2" id="kt_app_header_logo">
							<!--begin::Sidebar mobile toggle-->
							<div class="btn btn-icon btn-active-color-primary w-35px h-35px ms-3 me-5 d-flex d-lg-none" id="kt_app_sidebar_mobile_toggle">
								<i class="ki-solid ki-abstract-14 fs-2tx"></i>
							</div>

							<!--begin::Logo-->
							<a href="https://core.masterly.ca/" class="app-sidebar-logo">
								<img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-light-show d-lg-none" style="width:70%" />
								<img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-light-show d-lg-block d-none" style="width:95%" />
								<img alt="Logo" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-text-gray.png" class="theme-dark-show" style="width:100%" />
							</a>

							<!--begin::Sidebar toggle-->
							<div id="kt_app_sidebar_toggle" class="app-sidebar-toggle btn btn-sm btn-icon btn-color-gray-600 btn-active-color-dark me-n2 d-none d-lg-flex" data-kt-toggle="true" data-kt-toggle-state="active" data-kt-toggle-target="body" data-kt-toggle-name="app-sidebar-minimize" onclick="toggleSidebarIcon(this)" title="Click to toggle the sidebar">
								<i class="ki-duotone ki-element-7 fs-2x">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</div>
							<!--end::Sidebar toggle-->
						</div>
						<!--begin::Navbar-->
						<div class="app-navbar flex-grow-1 justify-content-end" id="kt_app_header_navbar">

							<!--search-->
							<div class="app-navbar-item d-flex align-items-stretch flex-lg-grow-1 me-2 me-lg-0">
								<div class="header-search d-flex align-items-center w-lg-350px" data-kt-search-keypress="true" data-kt-search-min-length="2" data-kt-search-enter="enter" data-kt-search-layout="menu" data-kt-search-responsive="true" data-kt-menu-trigger="auto" data-kt-menu-permanent="true" data-kt-menu-placement="bottom-start">
									<div class="d-none d-lg-block w-100 position-relative mb-5 mb-lg-0" autocomplete="off">
										<select data-control="select2" data-placeholder="Select a Masterly Service" class="form-select form-select-lg fw-semibold border-0 h-lg-40px" id="js-masterly-product-select">
											<option></option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/findware.svg" value="1">FindWare</option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/sos.svg" value="2">SOS</option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/forms.svg" value="3">Forms</option>
											<option data-kt-masterly-product-icon="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/orbit.svg" value="4">Orbit</option>
										</select>
									</div>
									<span class="badge badge-danger ms-5" id="js-product-free-trial-badge" style="display:none">free trial</span>
								</div>
							</div>

							<!--Header menu toggle-->
							<div class="app-navbar-item ms-3 ms-lg-4 ms-n2 me-3 d-flex d-lg-none">
								<div class="btn btn-icon btn-active-color-dark w-35px h-35px ms-3 me-2 d-flex d-lg-none" id="kt_app_aside_mobile_toggle">
									<i class="ki-solid ki-dots-vertical" style="font-size:30px; font-weight:bold"></i>
								</div>
							</div>


						</div>
						<!--end::Navbar-->
					</div>
					<!--end::Header main-->
					<!--begin::Separator-->
					<div class="app-header-separator"></div>
					<!--end::Separator-->
				</div>
				<!--end::Header-->
				<!--begin::Wrapper-->
				<div class="app-wrapper flex-column flex-row-fluid" id="kt_app_wrapper">
					<!--begin::Sidebar-->
					<div id="kt_app_sidebar" class="app-sidebar flex-column" data-kt-drawer="true" data-kt-drawer-name="app-sidebar" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="250px" data-kt-drawer-direction="start" data-kt-drawer-toggle="#kt_app_sidebar_mobile_toggle">
						<!--begin::Main-->
						<div class="d-flex flex-column justify-content-between h-100 hover-scroll-overlay-y my-2 d-flex flex-column" id="kt_app_sidebar_main" data-kt-scroll="true" data-kt-scroll-activate="true" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_header" data-kt-scroll-wrappers="#kt_app_main" data-kt-scroll-offset="5px">
							<!--begin::Sidebar menu-->
							<div id="#kt_app_sidebar_menu" data-kt-menu="true" data-kt-menu-expand="false" class="flex-column-fluid menu menu-sub-indention menu-column menu-rounded menu-active-bg mb-7">
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="https://core.masterly.ca/dashboard" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-home fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">Masterly Home</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="index.html" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-element-11 fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">Dashboard</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="https://core.masterly.ca/settings/profile" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-user fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">My profile</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div class="menu-item">
								<!--begin:Menu link-->
								<a class="menu-link" href="https://core.masterly.ca/get-started" target="_blank">
									<span class="menu-icon">
									<i class="ki-duotone ki-information-4 fs-1">
										<span class="path1"></span>
										<span class="path2"></span>
										<span class="path3"></span>
										<span class="path4"></span>
									</i>
									</span>
									<span class="menu-title">Tutorials</span>
								</a>
								<!--end:Menu link-->
								</div>
								<!--end:Menu item-->
								<!--begin:Menu item-->
								<div data-kt-menu-trigger="click" class="menu-item here show menu-accordion">
									<!--begin:Menu link-->
									<span class="menu-link">
										<span class="menu-icon">
											<i class="ki-duotone ki-note-2 fs-1">
												<span class="path1"></span>
												<span class="path2"></span>
												<span class="path3"></span>
 												<span class="path4"></span>
											</i>
										</span>
										<span class="menu-title">Galaxy</span>
										<span class="menu-arrow"></span>
									</span>
									<!--end:Menu link-->
									<!--begin:Menu sub-->
									<div class="menu-sub menu-sub-accordion">
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/profile.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Profile</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/publications.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Publications</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/grants.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Grants</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/projects.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Projects</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
										<!--begin:Menu item-->
										<div class="menu-item">
											<!--begin:Menu link-->
											<a class="menu-link" href="galaxy/compliance.html">
												<span class="menu-bullet">
													<span class="bullet bullet-dot"></span>
												</span>
												<span class="menu-title">Compliance</span>
											</a>
											<!--end:Menu link-->
										</div>
										<!--end:Menu item-->
									</div>
									<!--end:Menu sub-->
								</div>
								<!--end:Menu item-->
							</div>
							<!--end::Sidebar menu-->
							<!--begin::Footer-->
							<div class="app-sidebar-project-default app-sidebar-project-minimize text-center min-h-lg-400px flex-column-auto d-flex flex-column justify-content-end" id="kt_app_sidebar_footer">
								<!--begin::Illustration-->
								<img class="mx-auto mb-10" src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/masterly-logo-fav.png" style="padding:30px; width:50%">
								<!--end::Illustration-->
							</div>
							<!--end::Footer-->
						</div>
						<!--end::Main-->
					</div>
					<!--end::Sidebar-->
					<!--begin::Main-->
					<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
						<!--begin::Content wrapper-->
						<div class="d-flex flex-column flex-column-fluid">
							<!--begin::Toolbar-->
							<div id="kt_app_toolbar" class="app-toolbar pt-5">
								<!--begin::Toolbar container-->
								<div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
									<!--begin::Toolbar wrapper-->
									<div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
									</div>
									<!--end::Toolbar wrapper-->
								</div>
								<!--end::Toolbar container-->
							</div>
							<!--end::Toolbar-->
							<!--begin::Content-->
							<div id="kt_app_content" class="app-content flex-column-fluid">
							<!--begin::Content container-->
							<div id="kt_app_content_container" class="app-container container-fluid">

								<style>
								/* 3D-ish card style (shared) */
								.card-3d{
									border:1px solid rgba(255,255,255,.08);
									background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
									box-shadow:0 10px 20px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.06);
									border-radius:16px;
									transition:transform .15s ease, box-shadow .15s ease;
								}
								.card-3d:hover{ transform:translateY(-3px); box-shadow:0 14px 26px rgba(0,0,0,.32), inset 0 1px 0 rgba(255,255,255,.08); }
								.card-3d .card-header{ border-bottom:1px solid rgba(255,255,255,.07); }

								/* KPI tiles */
								.kpi .value{ font-size:2rem; font-weight:800; line-height:1; }
								.kpi .sub{ font-size:.8rem; opacity:.8 }

								/* minis */
								.sparkline{ height:52px; background:rgba(255,255,255,.06); border-radius:10px; }
								.progress-compact{ height:7px; border-radius:6px; background:rgba(255,255,255,.15); overflow:hidden }
								.progress-compact .bar{ height:100%; width:45%; background:rgba(72,140,255,.8) }

								/* lists */
								.feed-item + .feed-item{ border-top:1px dashed rgba(255,255,255,.1); }
								.deadlines li+li{ margin-top:.5rem }

								/* responsive nudges */
								@media (max-width: 991.98px){
									.kpi .value{ font-size:1.6rem; }
								}
								</style>

								<!-- KPIs -->
								<div class="row g-6 mb-6">
									<div class="col-6 col-lg-3">
										<div class="card card-3d kpi h-100">
											<div class="card-body d-flex align-items-center justify-content-between">
												<div>
													<div class="text-gray fs-8">Publications</div>
													<div class="value" id="kpi_publications_total">42</div>
													<div class="sub text-gray-400" id="kpi_publications_ytd">YTD: 5</div>
												</div>
												<i class="ki-duotone ki-book-open fs-2x opacity-75"></i>
											</div>
										</div>
									</div>
									<div class="col-6 col-lg-3">
										<div class="card card-3d kpi h-100">
											<div class="card-body d-flex align-items-center justify-content-between">
												<div>
													<div class="text-gray fs-8">Citations</div>
													<div class="value" id="kpi_citations_total">1,284</div>
													<div class="sub text-gray-400" id="kpi_hindex">h-index: 18</div>
												</div>
												<i class="ki-duotone ki-graph-up fs-2x opacity-75"></i>
											</div>
										</div>
									</div>
									<div class="col-6 col-lg-3">
										<div class="card card-3d kpi h-100">
											<div class="card-body d-flex align-items-center justify-content-between">
												<div>
													<div class="text-gray fs-8">Active Grants</div>
													<div class="value" id="kpi_grants_active">3</div>
													<div class="sub text-gray-400" id="kpi_grants_value">$650k · 9 mo avg</div>
												</div>
												<i class="ki-duotone ki-badge-dollar fs-2x opacity-75"></i>
											</div>
										</div>
									</div>
									<div class="col-6 col-lg-3">
										<div class="card card-3d kpi h-100">
											<div class="card-body d-flex align-items-center justify-content-between">
												<div>
													<div class="text-gray fs-8">Compliance Health</div>
													<div class="value" id="kpi_compliance_score">88</div>
													<div class="sub text-gray-400" id="kpi_compliance_issues">2 open</div>
												</div>
												<i class="ki-duotone ki-shield-tick fs-2x opacity-75"></i>
											</div>
										</div>
									</div>
								</div>

								<div class="row g-6">
									<!-- LEFT (wider) -->
									<div class="col-12 col-lg-8">
										<!-- Activity Feed -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Today at a Glance</h3>
												<div class="ms-auto d-flex gap-2">
													<span class="badge badge-light" role="button" id="flt_all">All</span>
													<span class="badge badge-light" role="button" id="flt_pubs">Publications</span>
													<span class="badge badge-light" role="button" id="flt_grants">Grants</span>
													<span class="badge badge-light" role="button" id="flt_projects">Projects</span>
													<span class="badge badge-light" role="button" id="flt_compliance">Compliance</span>
												</div>
											</div>
											<div class="card-body">
												<div id="activity_feed" class="vstack">
													<!-- Example item -->
													<div class="feed-item py-3 d-flex align-items-start gap-3">
														<i class="ki-duotone ki-star fs-2 text-warning mt-1"></i>
														<div>
															<div class="fw-semibold">"Graph Diets" cited by Lee et al.</div>
															<div class="text-gray-500 fs-8">Oct 8, 2025 · <a href="galaxy/publications.html#id=example">View</a></div>
														</div>
													</div>
													<div class="feed-item py-3 d-flex align-items-start gap-3">
														<i class="ki-duotone ki-calendar fs-2 text-info mt-1"></i>
														<div>
															<div class="fw-semibold">NSERC Discovery draft due</div>
															<div class="text-gray-500 fs-8">Oct 15, 2025 · <a href="galaxy/grants.html">Open Grants</a></div>
														</div>
													</div>
													<!-- /Example items -->
												</div>
											</div>
										</div>

										<!-- Research Impact -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Research Impact</h3>
											</div>
											<div class="card-body">
												<div class="row g-4 align-items-center">
													<div class="col-12 col-md-6">
														<div class="text-gray fs-8 mb-2">Citations (last 12 months)</div>
														<div id="impact_citations_sparkline" class="sparkline w-100"></div>
													</div>
													<div class="col-12 col-md-6">
														<div class="text-gray fs-8 mb-2">Top Topics</div>
														<div id="impact_top_topics" class="vstack gap-2">
															<div class="d-flex justify-content-between"><span>Climate adaptation</span><span class="text-success">+18%</span></div>
															<div class="d-flex justify-content-between"><span>Risk modeling</span><span class="text-success">+9%</span></div>
															<div class="d-flex justify-content-between"><span>Remote sensing</span><span class="text-success">+5%</span></div>
														</div>
													</div>
												</div>
												<div class="mt-4">
													<div class="text-gray fs-8 mb-1">Most influential paper (Q4)</div>
													<a id="impact_top_paper_link" href="galaxy/publications.html#id=top" class="fw-semibold">Adaptive Coastal Models</a>
													<span class="text-gray-500 fs-8"> · 46 citations (12m)</span>
												</div>
											</div>
										</div>

										<!-- Projects & Milestones -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Projects &amp; Milestones</h3>
											</div>
											<div class="card-body">
												<div class="row g-4">
													<div class="col-12 col-md-4">
														<div class="text-gray fs-8">Overdue</div>
														<div class="display-6 fw-bold" id="proj_overdue">1</div>
													</div>
													<div class="col-12 col-md-4">
														<div class="text-gray fs-8">Due this week</div>
														<div class="display-6 fw-bold" id="proj_thisweek">2</div>
													</div>
													<div class="col-12 col-md-4">
														<div class="text-gray fs-8">Upcoming</div>
														<div class="display-6 fw-bold" id="proj_upcoming">3</div>
													</div>
												</div>
												<div class="mt-4">
													<button class="btn btn-sm btn-light" id="btn_add_project_note">Add note / attach artifact</button>
												</div>
											</div>
										</div>
									</div>

									<!-- RIGHT (narrow) -->
									<div class="col-12 col-lg-4">
										<!-- Suggested Actions -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Suggested Actions</h3>
											</div>
											<div class="card-body vstack gap-2" id="actions_list">
												<button class="btn btn-light w-100 text-start" data-string="cv_ingest">Ingest latest CV</button>
												<button class="btn btn-light w-100 text-start" data-string="scholar_sync">Sync Google Scholar</button>
												<button class="btn btn-light w-100 text-start" data-string="funding_match">Generate Funding Matches</button>
												<button class="btn btn-light w-100 text-start" data-string="compliance_scan">Run Compliance Sweep</button>
												<button class="btn btn-light w-100 text-start" data-string="publish_profile">Publish Profile</button>
											</div>
										</div>

										<!-- Grants Pipeline -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Grants Pipeline</h3>
											</div>
											<div class="card-body">
												<div class="row text-center g-3">
													<div class="col">
														<div class="text-gray fs-8">Discover</div>
														<div class="fs-3 fw-bold" id="gr_pipeline_discover">2</div>
													</div>
													<div class="col">
														<div class="text-gray fs-8">Draft</div>
														<div class="fs-3 fw-bold" id="gr_pipeline_draft">1</div>
													</div>
													<div class="col">
														<div class="text-gray fs-8">Submitted</div>
														<div class="fs-3 fw-bold" id="gr_pipeline_submitted">1</div>
													</div>
													<div class="col">
														<div class="text-gray fs-8">Active</div>
														<div class="fs-3 fw-bold" id="gr_pipeline_active">3</div>
													</div>
												</div>
												<div class="mt-4">
													<div class="text-gray fs-8 mb-1">Next deadlines</div>
													<ul id="gr_next_deadlines" class="deadlines list-unstyled mb-0">
														<li>Progress report – Nov 1, 2025</li>
													</ul>
												</div>
											</div>
										</div>

										<!-- Compliance Health -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Compliance Health</h3>
											</div>
											<div class="card-body">
												<div class="d-flex align-items-center gap-3">
													<div class="display-5 fw-bold" id="comp_score_badge">88</div>
													<div>
														<div class="text-gray fs-8">Open issues</div>
														<div class="fw-semibold" id="comp_open_issues">2</div>
													</div>
												</div>
												<div class="mt-3 progress-compact"><div class="bar" id="comp_progress_bar" style="width:70%"></div></div>
												<div class="mt-4">
													<div class="text-gray fs-8 mb-1">Next action</div>
													<button class="btn btn-sm btn-light" id="comp_next_action_btn">Enable SSO for interns</button>
												</div>
											</div>
										</div>

										<!-- Calendar & Deadlines -->
										<div class="card card-3d mb-6">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Calendar &amp; Deadlines</h3>
											</div>
											<div class="card-body">
												<ul id="calendar_list" class="list-unstyled mb-0">
													<li class="d-flex align-items-center justify-content-between py-2">
														<span>Manuscript submit: Ocean Risk</span>
														<span class="badge badge-light">Oct 12</span>
													</li>
												</ul>
											</div>
										</div>

										<!-- Profile Completeness & Contacts -->
										<div class="card card-3d">
											<div class="card-header align-items-center">
												<h3 class="card-title fw-bold m-0">Profile &amp; Contacts</h3>
											</div>
											<div class="card-body">
												<div class="d-flex align-items-center justify-content-between">
													<div>
														<div class="text-gray fs-8">Profile completeness</div>
														<div class="fw-bold" id="profile_complete_pct">86%</div>
													</div>
													<button class="btn btn-sm btn-light" id="btn_fix_profile">Fix missing items</button>
												</div>
												<div class="mt-4">
													<div class="text-gray fs-8 mb-2">Key contacts</div>
													<div id="key_contacts" class="vstack gap-2">
														<div class="d-flex align-items-center gap-3">
															<div class="symbol symbol-30px"><span class="symbol-label bg-secondary"></span></div>
															<div><div class="fw-semibold">Dana (Program Officer)</div><a href="mailto:dana@agency.org" class="text-gray-500 fs-8">dana@agency.org</a></div>
														</div>
														<div class="d-flex align-items-center gap-3">
															<div class="symbol symbol-30px"><span class="symbol-label bg-secondary"></span></div>
															<div><div class="fw-semibold">Ravi (Compliance)</div><a href="mailto:ravi@uni.edu" class="text-gray-500 fs-8">ravi@uni.edu</a></div>
														</div>
													</div>
												</div>
											</div>
										</div>

									</div>
								</div>

							</div>
							<!--end::Content container-->
							</div>
							<!--end::Content-->
						</div>
						<!--end::Content wrapper-->
						<!--begin::Footer-->
						<div id="kt_app_footer" class="app-footer align-items-center justify-content-center justify-content-md-between flex-column flex-md-row py-3">

							<div class="text-dark order-2 order-md-1">
								<span class="text-muted fw-semibold me-1">2025&copy;</span>
								<a href="/" class="text-gray-800 text-hover-primary">Masterly Galaxy</a>        
							</div>

							<div class="text-dark order-2 order-md-1 center-block">
								<span class="fw-semibold">Made with <i class="fa fa-heart text-danger"></i> by Masterly Inc.</span>
							</div>
							
							<ul class="menu menu-gray-600 menu-hover-primary fw-semibold order-1">
								<li class="menu-item">
									<a href="https://masterly.ca/" target="_blank" class="menu-link px-2">About</a>
								</li>
								<li class="menu-item">
									<a href="mailto:support@masterly.ca/" target="_blank" class="menu-link px-2">Support</a>
								</li>
								<li class="menu-item">
									<a href="/terms-and-conditions" class="menu-link px-2" target="_blank">Terms & Conditions</a>
								</li>
								<li class="menu-item">
									<a href="/privacy-policy" class="menu-link px-2" target="_blank">Privacy Policy</a>
								</li>
							</ul>
							
						</div>
						<!--end::Footer-->
					</div>
					<!--end:::Main-->
					<!--begin::aside-->
					<div id="kt_app_aside" class="app-aside flex-column" data-kt-drawer="true" data-kt-drawer-name="app-aside" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="auto" data-kt-drawer-direction="end" data-kt-drawer-toggle="#kt_app_aside_mobile_toggle">

						<div id="kt_app_aside_wrapper" class="d-flex flex-column align-items-center hover-scroll-y py-5 py-lg-0 gap-4 d-lg-flex" data-kt-scroll="true" data-kt-scroll-activate="{default: false, lg: true}" data-kt-scroll-height="auto" data-kt-scroll-dependencies="#kt_app_header" data-kt-scroll-wrappers="#kt_app_aside_wrapper" data-kt-scroll-offset="5px">

							<a href="https://core.masterly.ca/settings/profile" class="btn btn-icon btn-color-muted bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Profile" data-bs-custom-class="tooltip-inverse" id="js-aside-profile">
								<i class="ki-duotone ki-user fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
									<span class="path3"></span>
								</i>
							</a>

							<a href="https://findware.masterly.ca/my-dashboard" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4 d-lg-none" data-bs-toggle="tooltip" title="Findware" data-bs-custom-class="tooltip-inverse">
								<img src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/findware.svg" class="h-45px w-45px" />
							</a>        
							<a href="https://sos.masterly.ca/my-dashboard" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4 d-lg-none" data-bs-toggle="tooltip" title="Masterly SOS" data-bs-custom-class="tooltip-inverse">
								<img src="https://masterly-apps.s3.ca-central-1.amazonaws.com/logos/sos.svg" class="h-45px w-45px" />
							</a>
							
							

							<a href="https://core.masterly.ca/settings/contacts" class="btn btn-icon btn-color-info bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Contacts" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-book fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
									<span class="path3"></span>
									<span class="path4"></span>
								</i>
							</a>
							<a href="https://core.masterly.ca/settings/security" class="btn btn-icon btn-color-primary bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Security" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-key fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</a>
							<a href="https://core.masterly.ca/settings/sessions" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Sessions" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-user-tick fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
									<span class="path3"></span>
								</i>
							</a>

							<a href="/sign-out" class="btn btn-icon btn-color-dark bg-hover-body h-45px w-45px flex-shrink-0 mb-4" data-bs-toggle="tooltip" title="Sign out" data-bs-custom-class="tooltip-inverse">
								<i class="ki-duotone ki-exit-right fs-2qx">
									<span class="path1"></span>
									<span class="path2"></span>
								</i>
							</a>
						</div>

					</div>
					<!--end::aside-->
				</div>
				<!--end::Wrapper-->
			</div>
			<!--end::Page-->
		</div>
		<!--end::App-->
		
		<!--begin::Scrolltop-->
		<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
			<i class="ki-duotone ki-arrow-up">
				<span class="path1"></span>
				<span class="path2"></span>
			</i>
		</div>
		<!--end::Scrolltop-->
		<!--begin::Modals-->
		
		<!--end::Modals-->
		<!--begin::Javascript-->
		<script>var hostUrl = "assets/";</script>

		<!-- Global JS bundle -->
		<script src="assets/plugins/global/plugins.bundle.js"></script>
		<script src="assets/js/scripts.bundle.js"></script>

		<!-- Vendors (if truly needed on this page) -->
		<script src="assets/plugins/custom/datatables/datatables.bundle.js"></script>

		<!-- Publications page logic -->
		<script src="assets/js/custom/galaxy/projects.js" type="module"></script>
		<!--end::Javascript-->

		<script type="module">
		/* =========================
		Galaxy Dashboard Binder
		========================= */

		const $  = (id) => document.getElementById(id);
		const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
		const today = new Date();
		const startOfYear = new Date(today.getFullYear(), 0, 1);
		const isLocal = ['localhost','127.0.0.1','0.0.0.0'].includes(location.hostname);
		const API = isLocal ? 'http://127.0.0.1:3001/api' : '/api';

		/* ---------- formatting ---------- */
		const fmt = {
		int: (n) => (Number(n)||0).toLocaleString(),
		moneyShort(n){
			n = Number(n) || 0; const a = Math.abs(n);
			if (a >= 1e9) return `$${(n/1e9).toFixed(1)}B`;
			if (a >= 1e6) return `$${(n/1e6).toFixed(1)}M`;
			if (a >= 1e3) return `$${(n/1e3).toFixed(1)}k`;
			return `$${n}`;
		},
		date(d){ const dt = new Date(d); return dt.toLocaleDateString(undefined, {month:'short', day:'numeric'}); }
		};

		const parseDate = (d) => {
		if (!d) return null;
		if (d instanceof Date) return d;
		const s = String(d).trim();
		const t = Date.parse(s.length === 4 ? `${s}-01-01` : s);
		return isNaN(t) ? null : new Date(t);
		};
		const sum = (arr, fn=x=>x) => arr.reduce((a,x)=>a + (+fn(x)||0), 0);
		const monthsBetween = (a,b) => (a - b) / (1000*60*60*24*30.437);
		const cap = (n,min,max) => Math.max(min, Math.min(max, n));

		/* ---------- cache + fetch helpers ---------- */
		function readCache(key){ try { return JSON.parse(localStorage.getItem(key)||'null'); } catch { return null; } }
		async function getJSON(url){ try { const r = await fetch(url, {cache:'no-store'}); return r.ok ? r.json() : null; } catch { return null; } }

		async function prefer(storeVal, cacheKey, apiPath){
		if (storeVal) return storeVal;
		const cache = readCache(cacheKey);
		if (cache) return cache;
		return await getJSON(`${API}/${apiPath}`);
		}

		/* ---------- source loader ---------- */
		async function loadSources(){
		const store = (window.GALAXY && window.GALAXY.data) || {};

		const [profile, pubsRaw, grantsRaw, projectsRaw, compliance] = await Promise.all([
			prefer(store.profile,      'galaxy_profile',     'profile'),
			prefer(store.publications, 'galaxy_publications','publications'),
			prefer(store.grants,       'galaxy_grants',      'grants'),
			prefer(store.projects,     'galaxy_projects',    'projects'),
			prefer(store.compliance,   'galaxy_compliance',  'compliance')
		]);

		// normalize shapes
		const publications = Array.isArray(pubsRaw?.publications) ? pubsRaw.publications : (Array.isArray(pubsRaw) ? pubsRaw : []);
		const grants       = Array.isArray(grantsRaw?.grants) ? grantsRaw.grants : (Array.isArray(grantsRaw) ? grantsRaw : []);
		const projects     = Array.isArray(projectsRaw?.projects) ? projectsRaw.projects : (Array.isArray(projectsRaw) ? projectsRaw : []);
		return { profile: profile||{}, publications, grants, projects, compliance: compliance||{} };
		}

		/* ---------- compute helpers ---------- */
		function hIndex(cites){
		const s = cites.filter(n => typeof n === 'number' && n >= 0).sort((a,b)=>b-a);
		let h=0; for (let i=0;i<s.length;i++){ if (s[i] >= i+1) h = i+1; else break; }
		return h;
		}
		function getPubDate(p){ return parseDate(p.date || p.published || p.year || p.meta?.date); }
		function getPubCites(p){
		if (typeof p.citations === 'number') return p.citations;
		if (typeof p.citationCount === 'number') return p.citationCount;
		if (typeof p.metrics?.citations === 'number') return p.metrics.citations;
		return 0;
		}
		function grantIsActive(g){
		const status = String(g.status || g.state || '').toLowerCase();
		const start = parseDate(g.start || g.start_date || g.period?.start);
		const end   = parseDate(g.end   || g.end_date   || g.period?.end);
		if (status.includes('active')) return true;
		const now = new Date();
		if (start && end) return start <= now && now <= end;
		if (!start && end) return now <= end;
		return false;
		}
		function grantAmount(g){ return Number(g.amount ?? g.total_amount ?? g.value ?? g.budget?.total ?? 0); }
		function nextDeadlinesFromGrants(grants, limit=5){
		const items = [];
		grants.forEach(g=>{
			const end = parseDate(g.end || g.end_date || g.period?.end);
			if (end && end >= today) items.push({title: g.title || g.name || 'Grant deadline', date: end, type:'grant'});
			if (Array.isArray(g.milestones)){
			g.milestones.forEach(m=>{
				const d = parseDate(m.date || m.due); if (d && d>=today) items.push({title: m.title || 'Milestone', date: d, type:'grant'});
			});
			}
		});
		return items.sort((a,b)=>a.date-b.date).slice(0, limit);
		}
		function countsByStatus(items, path='status'){
		const get = (it)=>String(path.split('.').reduce((a,k)=>a?.[k], it)||'').toLowerCase();
		return items.reduce((acc,it)=>{ const s=get(it)||'unknown'; acc[s]=(acc[s]||0)+1; return acc; },{});
		}
		function topTopics(publications, n=3){
		const counts = new Map();
		const add = (t)=>{ const k=String(t||'').trim().toLowerCase(); if(!k) return; counts.set(k,(counts.get(k)||0)+1); };
		publications.forEach(p=>{
			if (Array.isArray(p.keywords)) p.keywords.forEach(add);
			if (Array.isArray(p.tags))     p.tags.forEach(add);
			if (typeof p.topics === 'string') p.topics.split(/[,\|;·•]+/).forEach(add);
		});
		return Array.from(counts, ([name,count])=>({name,count})).sort((a,b)=>b.count-a.count).slice(0,n);
		}
		function citationsLast12m(publications){
		// fallback: distribute each paper's citations uniformly across its age; if you have per-month data, replace this.
		const months = Array(12).fill(0);
		const now = new Date();
		publications.forEach(p=>{
			const c = getPubCites(p);
			const d = getPubDate(p) || now;
			const ageMonths = Math.max(1, Math.round(monthsBetween(now, d)));
			const perMonth = c / cap(ageMonths,1,120);
			for (let i=0;i<12;i++) months[i]+=perMonth;
		});
		return months.map(v=>Math.round(v));
		}
		function mostInfluentialPaper(publications){
		if (!publications.length) return null;
		const sorted = [...publications].sort((a,b)=>getPubCites(b)-getPubCites(a));
		const top = sorted[0];
		return top ? { title: top.title || top.name || 'Top paper', citations_12m: getPubCites(top), id: top.id } : null;
		}

		/* ---------- small UI helpers ---------- */
		function setText(id, txt){ const el=$(id); if(el) el.textContent = txt; }
		function setBar(id, pct){ const el = $(id); if(el){ el.style.width = `${cap(pct,0,100)}%`; } }
		function pulse(id){ const el=$(id); if(!el) return; el.style.transition='transform .15s ease'; el.style.transform='scale(1.05)'; setTimeout(()=>{ el.style.transform='scale(1)'; }, 160); }
		function renderSparkline(id, data){
		const el = $(id); if(!el) return;
		const w = el.clientWidth || 240, h = el.clientHeight || 52;
		const max = Math.max(...data, 1);
		const step = w / (data.length-1);
		const points = data.map((v,i)=>`${i*step},${h - (v/max)*h}`).join(' ');
		el.innerHTML = `<svg width="100%" height="100%" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
			<polyline points="${points}" fill="none" stroke="currentColor" stroke-width="2" opacity="0.85"></polyline>
		</svg>`;
		}

		/* ---------- bind everything ---------- */
		async function bindDashboard(){
		const { profile, publications, grants, projects, compliance } = await loadSources();

		/* KPIs */
		const pubDates = publications.map(getPubDate).filter(Boolean);
		setText('kpi_publications_total', fmt.int(pubDates.length));
		setText('kpi_publications_ytd', `YTD: ${fmt.int(pubDates.filter(d=>d>=startOfYear).length)}`);

		const perPaperCites = publications.map(getPubCites);
		const citationsTotal = sum(perPaperCites);
		const h = hIndex(perPaperCites);
		setText('kpi_citations_total', fmt.int(citationsTotal));
		setText('kpi_hindex', `h-index: ${fmt.int(h)}`);

		const active = grants.filter(grantIsActive);
		const monthsLeftArr = active.map(g=>{ const end=parseDate(g.end || g.end_date || g.period?.end); return end ? Math.max(0, monthsBetween(end, today)) : 0; }).filter(x=>x>0);
		const monthsLeftAvg = monthsLeftArr.length ? Math.round(sum(monthsLeftArr)/monthsLeftArr.length) : 0;
		setText('kpi_grants_active', fmt.int(active.length));
		setText('kpi_grants_value', `${fmt.moneyShort(sum(active, grantAmount))} · ${monthsLeftAvg} mo avg`);

		const compScore = Number(compliance.score ?? compliance.health_score ?? 0);
		const openIssues = Array.isArray(compliance.open_issues) ? compliance.open_issues.length
							: (typeof compliance.open_issues_count==='number' ? compliance.open_issues_count
							: (Array.isArray(compliance.issues) ? compliance.issues.filter(i=>!i.resolved && !i.closed).length : 0));
		setText('kpi_compliance_score', fmt.int(compScore));
		setText('kpi_compliance_issues', `${fmt.int(openIssues)} open`);

		['kpi_publications_total','kpi_citations_total','kpi_grants_active','kpi_compliance_score'].forEach(pulse);

		/* Activity feed (very light stub: last two events from grants & pubs) */
		const feed = [];
		publications.slice(0,1).forEach(p=>{
			const when = getPubDate(p) || today;
			feed.push({icon:'ki-star', title:`"${p.title||'New publication'}" added`, date: when, link:'galaxy/publications.html'});
		});
		const nd = nextDeadlinesFromGrants(grants, 3);
		nd.forEach(d=>feed.push({icon:'ki-calendar', title:d.title, date:d.date, link:'galaxy/grants.html'}));
		const feedEl = $('activity_feed');
		if (feedEl){
			feedEl.innerHTML = feed.slice(0,6).map(item=>`
			<div class="feed-item py-3 d-flex align-items-start gap-3">
				<i class="ki-duotone ${item.icon} fs-2 text-info mt-1"></i>
				<div>
				<div class="fw-semibold">${item.title}</div>
				<div class="text-gray-500 fs-8">${fmt.date(item.date)} · <a href="${item.link}">Open</a></div>
				</div>
			</div>`).join('');
		}

		/* Research Impact */
		renderSparkline('impact_citations_sparkline', citationsLast12m(publications));
		const topics = topTopics(publications, 3);
		const topBox = $('impact_top_topics');
		if (topBox){
			topBox.innerHTML = topics.map(t=>`
			<div class="d-flex justify-content-between">
				<span>${t.name}</span>
				<span class="text-success">+${fmt.int(t.count)}</span>
			</div>`).join('');
		}
		const topPaper = mostInfluentialPaper(publications);
		if (topPaper){
			const link = $('impact_top_paper_link');
			if (link){ link.textContent = topPaper.title; link.href = `galaxy/publications.html#id=${encodeURIComponent(topPaper.id||'top')}`; }
			// (small hack: reuse its adjacent span for count)
			const span = link ? link.nextElementSibling : null;
			if (span) span.textContent = ` · ${fmt.int(topPaper.citations_12m)} citations (12m)`;
		}

		/* Projects & Milestones */
		const projStatus = countsByStatus(projects, 'status');
		// suppose statuses: overdue, due_this_week, upcoming; else compute by due dates
		const today0 = new Date(); today0.setHours(0,0,0,0);
		const thisWeekEnd = new Date(today0); thisWeekEnd.setDate(today0.getDate() + 7);
		let overdue=0, thisweek=0, upcoming=0;
		if (Object.keys(projStatus).length > 0){
			overdue  = projStatus.overdue  || 0;
			thisweek = projStatus['due this week'] || projStatus.this_week || 0;
			upcoming = projStatus.upcoming || 0;
		} else {
			projects.forEach(p=>{
			const due = parseDate(p.due || p.deadline); if(!due) return;
			if (due < today0) overdue++;
			else if (due <= thisWeekEnd) thisweek++;
			else upcoming++;
			});
		}
		setText('proj_overdue',  fmt.int(overdue));
		setText('proj_thisweek', fmt.int(thisweek));
		setText('proj_upcoming', fmt.int(upcoming));

		/* Grants Pipeline + Deadlines */
		const gStatus = countsByStatus(grants, 'status');
		setText('gr_pipeline_discover',  fmt.int(gStatus.discover || gStatus.discovery || 0));
		setText('gr_pipeline_draft',     fmt.int(gStatus.draft || 0));
		setText('gr_pipeline_submitted', fmt.int(gStatus.submitted || 0));
		setText('gr_pipeline_active',    fmt.int(gStatus.active || active.length));
		const dl = nextDeadlinesFromGrants(grants, 5);
		const dlEl = $('gr_next_deadlines');
		if (dlEl){
			dlEl.innerHTML = dl.map(d=>`<li>${d.title} – ${fmt.date(d.date)}</li>`).join('') || '<li class="text-gray-500">No upcoming deadlines</li>';
		}

		/* Compliance Health */
		setText('comp_score_badge', fmt.int(compScore));
		setText('comp_open_issues', fmt.int(openIssues));
		setBar('comp_progress_bar', compScore);
		const nextActionBtn = $('comp_next_action_btn');
		if (nextActionBtn){
			const na = compliance.next_action || compliance.nextRequiredAction || (Array.isArray(compliance.issues) && compliance.issues.find(i=>!i.resolved && !i.closed)?.title);
			if (na) nextActionBtn.textContent = na;
		}

		/* Calendar (aggregate from grants+projects quick view) */
		const calendar = [...dl, ...projects.map(p=>{
			const d = parseDate(p.due || p.deadline); return d ? {title:p.title||'Project milestone', date:d, type:'project'} : null;
		}).filter(Boolean)];
		calendar.sort((a,b)=>a.date-b.date);
		const calEl = $('calendar_list');
		if (calEl){
			calEl.innerHTML = calendar.slice(0,6).map(ev=>`
			<li class="d-flex align-items-center justify-content-between py-2">
				<span>${ev.title}</span><span class="badge badge-light">${fmt.date(ev.date)}</span>
			</li>`).join('') || `
			<li class="py-2 text-gray-500">No upcoming items</li>`;
		}

		/* Profile Completeness & Contacts */
		if (profile){
			const pct = Number(profile.completeness_pct ?? profile.progress ?? 0);
			setText('profile_complete_pct', `${fmt.int(pct)}%`);
			const contacts = Array.isArray(profile.contacts) ? profile.contacts
							: (Array.isArray(profile.key_contacts) ? profile.key_contacts : []);
			const kc = $('key_contacts');
			if (kc && contacts.length){
			kc.innerHTML = contacts.slice(0,4).map(c=>`
				<div class="d-flex align-items-center gap-3">
				<div class="symbol symbol-30px"><span class="symbol-label bg-secondary"></span></div>
				<div>
					<div class="fw-semibold">${c.name || c.title || 'Contact'}</div>
					${c.email ? `<a href="mailto:${c.email}" class="text-gray-500 fs-8">${c.email}</a>` : ''}
				</div>
				</div>`).join('');
			}
		}
		}

		/* Initial bind + reactive updates when caches change from other pages/tabs */
		await bindDashboard();
		window.addEventListener('storage', (e)=>{
		if (!e.key || !e.key.startsWith('galaxy_')) return;
		bindDashboard(); // re-pull sources and refresh
		});
		</script>
		</body>
		</html>
	<!--end::Body-->
</html>
